(()=>{document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("input, textarea").forEach(e=>{e.addEventListener("focus",function(){this.dataset.placeholder=this.placeholder,this.placeholder=""}),e.addEventListener("blur",function(){this.placeholder=this.dataset.placeholder||""})});let c=document.getElementById("sidebar-menu"),l=window.scrollY;c&&window.addEventListener("scroll",()=>{window.scrollY>l?(c.classList.remove("lg:top-[40px]"),c.classList.add("lg:top-[-400px]")):(c.classList.remove("lg:top-[-400px]"),c.classList.add("lg:top-[40px]")),l=window.scrollY});let a=document.getElementById("menu-toggle"),t=document.getElementById("mobile-menu");a&&t&&(a.addEventListener("click",e=>{e.stopPropagation(),a.classList.contains("is-active")?(t.classList.remove("-translate-x-[1700px]"),t.classList.add("translate-x-0"),document.body.style.overflow="hidden"):(t.classList.remove("translate-x-0"),t.classList.add("-translate-x-[1700px]"),document.body.style.overflow=""),a.classList.toggle("is-active")}),document.addEventListener("click",e=>{!t.contains(e.target)&&!a.contains(e.target)&&(t.classList.remove("translate-x-0"),t.classList.add("-translate-x-[1700px]"),a.classList.add("is-active"),document.body.style.overflow="")}));let m=document.querySelectorAll(".sidebar-toggle"),f=document.getElementById("sidebar-menu");m.length&&f&&m.forEach(e=>{e.addEventListener("click",n=>{n.stopPropagation(),e.classList.contains("is-active")?(f.classList.remove("-translate-x-[1700px]"),f.classList.add("translate-x-0")):(f.classList.remove("translate-x-0"),f.classList.add("-translate-x-[1700px]")),e.classList.toggle("is-active")}),document.querySelectorAll(".close-filter-btn").forEach(n=>{n.addEventListener("click",()=>{e.classList.toggle("is-active"),f.classList.remove("translate-x-0"),f.classList.add("-translate-x-[1700px]")})}),document.addEventListener("click",n=>{!f.contains(n.target)&&!e.contains(n.target)&&(f.classList.remove("translate-x-0"),f.classList.add("-translate-x-[1700px]"),e.classList.add("is-active"))})});let L=new Swiper(".swiper_rev",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".rev-button-next",prevEl:".rev-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});L.on("init",()=>{document.querySelector(".rev-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".rev-button-next").classList.remove("swiper-button-disabled")}),L.init();let x=new Swiper(".swiper_similar",{slidesPerView:1,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".similar-button-next",prevEl:".similar-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});L.on("init",()=>{document.querySelector(".similar-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".similar-button-next").classList.remove("swiper-button-disabled")}),L.init();let y=new Swiper(".swiper_gids",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".gid-button-next",prevEl:".gid-button-prev"},breakpoints:{490:{slidesPerView:3.5,spaceBetween:32}}});y.on("init",()=>{document.querySelector(".gid-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".gid-button-next").classList.remove("swiper-button-disabled")}),y.init();let C=new Swiper(".swiper_custom",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}}),D=new Swiper(".swiper_four",{slidesPerView:1.2,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:24},1100:{slidesPerView:4,spaceBetween:24}}}),T=new Swiper(".swiper_five",{slidesPerView:1.2,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:24},1100:{slidesPerView:5,spaceBetween:24}}});if(document.querySelectorAll(".swiper_tour").length){let e=new Swiper(".mySwiper2",{spaceBetween:8,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}});document.querySelectorAll(".fancy-video img").forEach(o=>{let d=o.getAttribute("src"),p=o.getAttribute("alt"),u=o.getAttribute("data-video-id"),s=o.getAttribute("data-video-type");if(!u)o.setAttribute("data-src",d),o.setAttribute("data-caption",p);else{let r="";s==="youtube"?r=`https://www.youtube.com/embed/${u}?autoplay=1`:s==="rutube"?r=`https://rutube.ru/play/embed/${u}?autoplay=1`:s==="dzen"&&(r=u),o.setAttribute("data-fancybox","gallery"),o.setAttribute("data-src",r),o.setAttribute("data-caption",p)}}),Fancybox.bind('[data-fancybox="gallery"]',{infinite:!0,groupAll:!0,caption:function(o,d,p){return p.alt}})}if(document.querySelectorAll(".swiper_block")){let e=new Swiper(".swiperBlock",{slidesPerView:2.2,spaceBetween:11,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{490:{slidesPerView:2.2,spaceBetween:11},790:{slidesPerView:3,spaceBetween:24},1023:{slidesPerView:5,spaceBetween:24}}})}if(document.querySelectorAll(".swiper_small")){let e=new Swiper(".swiper_small",{slidesPerView:1.5,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".rev-button-next",prevEl:".rev-button-prev"},breakpoints:{490:{slidesPerView:4,spaceBetween:24}}})}let q=null,i=flatpickr("#calendar",{inline:!0,mode:"range",minDate:"today",dateFormat:"Y-m-d",locale:"ru",onChange:function(e,n){q={dates:e,range:n}}}),b=document.getElementById("okBtn"),$=document.getElementById("cancelBtn");b&&$&&(b.addEventListener("click",function(){q&&q.dates.length?(document.querySelector('input[name="dateForm"]').value=q.range,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0}))):alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D \u0434\u0430\u0442!")}),$.addEventListener("click",function(){q=null,i.clear(),J(),H(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(e=>{let n=window.location.origin+window.location.pathname;e.href=n.toString()})}));function R(){document.querySelectorAll(".calendar-wrapper").forEach(e=>{let n=e.querySelector(".calendar"),o=e.getAttribute("data-dates"),d=o?JSON.parse(o):[],p=flatpickr(n,{inline:!0,minDate:"today",dateFormat:"Y-m-d",locale:"ru",defaultDate:d,disable:[function(u){let s=u.toISOString().split("T")[0];return!d.includes(s)&&u<new Date}],onReady:function(){n.querySelectorAll(".flatpickr-day").forEach(s=>{let r=s.getAttribute("aria-label");!d.includes(r)&&s.classList.contains("flatpickr-disabled")&&s.classList.remove("selected")})},onChange:function(){p.setDate(d,!1)}})})}if(R(),document.addEventListener("click",function(e){e.target.id==="cancelBtnFilter"&&(q=null,i.clear(),J(),H(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(o=>{let d=window.location.origin+window.location.pathname;o.href=d.toString()}))}),document.addEventListener("click",function(e){let n=document.querySelectorAll(".dropdown-button"),o=document.querySelectorAll(".dropdown-menu"),d=e.target.closest(".dropdown-button");if(d){let s=Array.from(n).indexOf(d),r=o[s];if(!r)return;let g=r.classList.contains("hidden");o.forEach((h,w)=>{w!==s&&(h.classList.add("hidden"),n[w].setAttribute("aria-expanded","false"))}),g?(r.classList.remove("hidden"),d.setAttribute("aria-expanded","true")):(r.classList.add("hidden"),d.setAttribute("aria-expanded","false"));return}let p=e.target.closest(".dropdown-menu .item");if(p){let s=p.closest(".dropdown-menu"),r=document.querySelector('.dropdown-button[aria-expanded="true"]');s&&r&&(s.classList.add("hidden"),r.setAttribute("aria-expanded","false"));return}let u=e.target.closest(".dropdown-menu .close-menu");if(u){let s=u.closest(".dropdown-menu"),r=document.querySelector('.dropdown-button[aria-expanded="true"]');s&&r&&(s.classList.add("hidden"),r.setAttribute("aria-expanded","false"));return}o.forEach((s,r)=>{!s.contains(e.target)&&!n[r].contains(e.target)&&(s.classList.add("hidden"),n[r].setAttribute("aria-expanded","false"))})}),document.getElementById("category_id")){let n=function(){let o=h=>Array.from(document.querySelectorAll(`#filter-form input[name="${h}"]:checked, #sort_form input[name="${h}"]:checked`)).map(w=>w.value),d=o("duration"),p=o("price"),u=-1,s=o("grade_sort"),r=document.querySelector('input[name="dateForm"]').value??null,g=new URLSearchParams({grade_sort:JSON.stringify(s),price:JSON.stringify(p),duration:JSON.stringify(d),dateForm:r,posts_per_page:u,category_id:e});document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(h=>{let w=new URL(h.href);r&&w.searchParams.set("dateForm",r),p&&w.searchParams.set("price",JSON.stringify(p)),d&&w.searchParams.set("duration",JSON.stringify(d)),h.href=w.toString()}),fetch("/wp-json/my_namespace/v1/filter-posts/?"+g.toString()).then(h=>{if(!h.ok)throw new Error("Failed to fetch the template.");return h.json()}).then(h=>{console.log(h.data),document.getElementById("tours").innerHTML=h.data.html,document.getElementById("card_link").scrollIntoView({block:"start",behavior:"smooth"}),R(),z();let w=document.querySelectorAll(".sidebar-toggle"),E=document.getElementById("sidebar-menu");w.length&&E&&(w.forEach(v=>{v.classList.toggle("is-active")}),E.classList.remove("translate-x-0"),E.classList.add("-translate-x-[1700px]"))}).catch(h=>console.error("Error loading posts:",h))};var se=n;let e=document.getElementById("category_id").value;document.getElementById("filter-form").addEventListener("change",function(){n()}),document.getElementById("sort_form").addEventListener("change",function(){n()})}function J(){let e=document.getElementById("filter-form");Array.from(e.elements).forEach(n=>{switch(n.type){case"text":case"textarea":case"password":case"email":case"url":case"number":case"search":case"tel":case"hidden":n.value="";break;case"checkbox":case"radio":n.checked=!1;break;case"select-one":case"select-multiple":n.selectedIndex=-1;break;default:break}})}function H(){let e=window.location.origin+window.location.pathname;window.history.replaceState({},document.title,e)}function Y(e){return e.trim()?/^(\+7|8)?[\s-]?(\(?\d{3}\)?)?[\s-]?\d{3}[\s-]?\d{2}[\s-]?\d{2}$/.test(e.trim()):!1}let W=document.querySelector(".reviews_form");if(W){let n=function(r,g){Array.from(g.querySelectorAll(".data-item")).forEach(w=>{w.style.display="block"}),g.classList.remove("hidden")},o=function(r,g){let h=r.value.toLowerCase(),w=Array.from(g.querySelectorAll(".data-item"));if(h===""){g.classList.add("hidden");return}let E=!1;w.forEach(v=>{v.textContent.toLowerCase().includes(h)?(v.style.display="block",E=!0):v.style.display="none"}),E?g.classList.remove("hidden"):g.classList.add("hidden")},d=function(){document.querySelectorAll(".reviews_form placeholder ul").forEach(r=>{r.classList.add("hidden")})};var re=n,ae=o,ie=d;let e=document.getElementById("inputField");document.querySelectorAll(".list-input input[name]").forEach(r=>{let g=r.nextElementSibling;if(!g)return;let h=()=>{g.classList.remove("hidden")},w=()=>{g.classList.add("hidden")};r.addEventListener("focus",h),r.addEventListener("input",()=>{let E=r.value.toLowerCase();g.querySelectorAll(".data-item").forEach(v=>{let A=v.textContent.toLowerCase();v.style.display=A.includes(E)?"block":"none"}),h()}),g.addEventListener("mousedown",E=>{let v=E.target.closest(".data-item");v&&(r.value=v.textContent,document.querySelector('input[name="excurs"]').value=v.getAttribute("data-name"),w())}),document.addEventListener("click",E=>{!r.contains(E.target)&&!g.contains(E.target)&&w()})});let p=document.getElementById("photo-input"),u=document.getElementById("preview-container"),s=[];p.addEventListener("change",r=>{Array.from(r.target.files||[]).forEach(h=>{if(!h.type.startsWith("image/"))return;let w=new FileReader;w.onload=E=>{let v=document.createElement("div");v.classList.add("preview");let A=document.createElement("img");A.src=E.target?.result;let I=document.createElement("button");I.innerText="\xD7",I.onclick=()=>{let S=s.indexOf(h);S>-1&&s.splice(S,1),u.removeChild(v)},v.appendChild(A),v.appendChild(I),u.appendChild(v)},w.readAsDataURL(h),s.push(h)}),p.value=""}),W.addEventListener("submit",function(r){r.preventDefault();let g=this.querySelector(".send-btn"),h=g.querySelector(".btn-text"),w=g.querySelector(".loader"),E=r.target,v=E.querySelector("[name=name]").value,A=new FormData(E);s.forEach((S,M)=>{A.append(`file[${M}]`,S)});let I=document.querySelector(".name_field input");if(v)I.classList.remove("alert"),g.disabled=!0,h.classList.add("hidden"),w.classList.remove("hidden");else return I.classList.add("alert"),window.scrollTo({top:document.querySelector(".reviews_form").offsetTop-50,behavior:"smooth"}),!1;setTimeout(()=>{let S=document.querySelector('.popup[data-popup="popup-success-rev"]');S&&S.classList.remove("hidden"),g.disabled=!1,h.classList.remove("hidden"),w.classList.add("hidden")},2500),fetch("/wp-json/custom/v1/reviews-form",{method:"POST",headers:{},body:A}).then(S=>S.ok?S.json():S.json().then(M=>{throw new Error(M.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(S=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",S)}).catch(S=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",S)}).finally(()=>{E.reset(),s.length=0,u.innerHTML=""})})}document.querySelectorAll(".send-letter").forEach(e=>{e.addEventListener("submit",function(n){n.preventDefault();let o=n.target,d=o.getAttribute("data-api"),p=new FormData(o),u=o.querySelector('input[name="tel"]');if(u){let s=p.get("tel");if(Y(s))Y(s)&&u.classList.remove("border","border-[#FF7A45]");else return u.classList.add("border","border-[#FF7A45]"),!1}d&&fetch(`/wp-json/custom/v1/${d}`,{method:"POST",headers:{},body:p}).then(s=>s.ok?s.json():s.json().then(r=>{throw new Error(r.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(s=>{if(!s.success)throw new Error(s.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B");return o.reset(),G(),document.querySelector(".popup[data-popup='popup-success']").classList.remove("hidden"),!0}).catch(s=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",s),alert(s.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})})}),document.querySelectorAll("[data-open]").forEach(e=>{e.addEventListener("click",function(){let n=e.getAttribute("data-open"),o=document.querySelector(`.popup[data-popup="${n}"]`);o&&o.classList.remove("hidden")})});function oe(e){e.classList.remove("hidden")}function G(){document.querySelectorAll(".popup-close").forEach(e=>{let n=e.closest(".popup");n&&n.classList.add("hidden")})}document.querySelectorAll(".popup-close").forEach(e=>{e.addEventListener("click",function(){let n=e.closest(".popup");n&&n.classList.add("hidden")})}),document.querySelectorAll(".popup").forEach(e=>{e.addEventListener("click",function(n){if(n.target===e){e.classList.add("hidden");let o=e.querySelector(".popup-media-container");o&&(o.innerHTML="")}})}),document.querySelectorAll(".togler").forEach(e=>{e.textContent="\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432",e.addEventListener("click",()=>{e.textContent=e.textContent==="\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432"?"\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C \u043E\u0442\u0437\u044B\u0432":"\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432";let n=e.closest(".text_toggle").querySelector(".rev-text");n&&(n.classList.toggle("long-rev"),n.classList.toggle("short-rev"))})});function z(){let e=document.getElementById("response");if(!e)return;let n=e.querySelectorAll(".wish-btn");if(o(n),e.dataset.initialized)return;e.dataset.initialized=!0,e.addEventListener("click",p=>{let u=p.target.closest(".wish-btn");u&&d(u)});function o(p){let u=P("product");try{u=u?JSON.parse(u):[]}catch(s){console.error("Error parsing cookies:",s),u=[]}p.forEach(s=>{let r=s.getAttribute("data-wp-id");u.includes(r)&&s.classList.add("active")})}function d(p){let u=P("product");try{u=u?JSON.parse(u):[]}catch(r){console.error("Error parsing cookies:",r),u=[]}let s=p.getAttribute("data-wp-id");u.includes(s)?(u=u.filter(r=>r!==s),p.classList.remove("active")):(u.push(s),p.classList.add("active")),K("product",JSON.stringify(u),7),U("product","#product-count span","#product-count div")}}z();function U(e,n,o){let d=P(e);if(d)try{let p=JSON.parse(d);Array.isArray(p)&&(document.querySelector(n).textContent=p.length,p.length<1?document.querySelector(o).style.visibility="hidden":document.querySelector(o).style.visibility="visible")}catch(p){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0435 \u043A\u0443\u043A\u0438 '"+e+"':",p)}else document.querySelector(n).textContent=0}U("product","#product-count span","#product-count div");function P(e){let n=document.cookie.split(";");for(let o=0;o<n.length;o++){let d=n[o].trim();if(d.startsWith(e+"="))return d.substring(e.length+1)}return null}function K(e,n,o){let d=new Date;d.setTime(d.getTime()+o*24*60*60*1e3);let p="expires="+d.toUTCString();document.cookie=e+"="+n+";"+p+";path=/"}document.body.addEventListener("click",function(e){if(e.target.classList.contains("delete")){let n=Array.from(document.querySelectorAll(".delete")).indexOf(e.target);console.log("\u0423\u0434\u0430\u043B\u044F\u0435\u043C \u0444\u0430\u0439\u043B:",n),filestoupload.splice(n,1),e.target.parentElement.remove(),console.log("Files to upload:",filestoupload.length)}}),window.addEventListener("scroll",function(){if(window.innerWidth>=1024)return;let e=document.getElementById("card_link"),n=document.getElementById("sticky-element");if(!e||!n)return;let o=e.getBoundingClientRect();o.top<=0&&o.bottom>=1e3?(n.classList.add("fixed"),n.classList.remove("hidden")):(n.classList.remove("fixed"),n.classList.add("hidden"))});let F=document.querySelectorAll(".int_mesta .item"),B=document.querySelector(".show-more");F.length&&B&&(F.length>6&&B.classList.remove("hidden"),B.addEventListener("click",function(){F.forEach(e=>e.classList.remove("hidden")),B.classList.add("hidden")}));let k=document.querySelector(".g-scrolling-carousel .overflow-x-auto");if(k){let e=!1,n,o;k.addEventListener("wheel",function(d){d.preventDefault(),k.scrollLeft+=d.deltaY}),k.addEventListener("mousedown",function(d){e=!0,n=d.pageX-k.offsetLeft,o=k.scrollLeft}),k.addEventListener("mouseleave",function(){e=!1}),k.addEventListener("mouseup",function(){e=!1}),k.addEventListener("mousemove",function(d){if(!e)return;d.preventDefault();let u=(d.pageX-k.offsetLeft-n)*3;k.scrollLeft=o-u})}let O=document.getElementById("scrollToTop");window.addEventListener("scroll",function(){window.scrollY>=800?O.classList.remove("hidden","opacity-0"):O.classList.add("hidden","opacity-0")}),O.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})});document.addEventListener("DOMContentLoaded",()=>{async function c(){let l=document.getElementById("order_form-page");if(l&&l.dataset.crm){let a=l.dataset.crm;fetch("/wp-json/custom/v1/tour_tickets?id="+a,{method:"POST",headers:{"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445");return t.json()}).then(t=>{window.dates=t;let m=document.querySelector('#order_form-page [type="date"]');m&&(m.value=window.dates.min_date,m.setAttribute("value",window.dates.min_date),m.setAttribute("min",window.dates.min_date),m.setAttribute("max",window.dates.max_date),m.dispatchEvent(new Event("change"))),document.dispatchEvent(new Event("dates_loaded",{bubbles:!0}))}).catch(t=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",t)})}}c().then(()=>{document.querySelector('#order_form-page [type="date"]')?.addEventListener("change",function(){let l=this.value,a="",t=[],m=[],f=[];if(window.dates&&window.dates.dates){window.dates.dates.forEach(i=>{f.includes(i.date)||(f.push(i.date),m.push(i)),l===i.date&&(i.time===i.a1||!i.a1||i.a1==="undefined")&&(a+=`<button type="button" class="time_btn tickets_addr_item" data-id="${i.id}"  data-crm="${i.tour_id}" data-time="${i.time}" data-ticks="${i.tickets}" data-a="a1"> ${i.time} </button>`)});let L=new Date,x=new Date;x.setDate(L.getDate()+1);let y=new Date;y.setDate(L.getDate()+2);let C=_(L.toISOString().split("T")[0]),D=_(x.toISOString().split("T")[0]),T=_(y.toISOString().split("T")[0]),V=m.some(i=>_(i.date)===C),j=m.some(i=>_(i.date)===D),N=m.some(i=>_(i.date)===T);if(V){let i=m.find(b=>_(b.date)===C);t.push({label:"\u0421\u0435\u0433\u043E\u0434\u043D\u044F",date:_(i.date),dateItem:i.date})}if(j){let i=m.find(b=>_(b.date)===D);t.push({label:"\u0417\u0430\u0432\u0442\u0440\u0430",date:_(i.date),dateItem:i.date})}if(N){let i=m.find(b=>_(b.date)===T);t.push({label:"\u041F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430",date:_(i.date),dateItem:i.date})}m.slice(t.length,t.length+3).forEach(i=>{t.length<3&&t.push({label:Z(i.date),date:_(i.date),dateItem:i.date})}),flatpickr("#calendarSelected",{inline:!0,minDate:"today",dateFormat:"Y-m-d",locale:"ru",enable:f,onChange:function(i,b){document.querySelector('#order_form-page [type="date"]').value=b,document.querySelector('#order_form-page [type="date"]').setAttribute("value",b),document.querySelector('#order_form-page [type="date"]').dispatchEvent(new Event("change"))}});let q=document.getElementById("dateButtonsContainer");q.innerHTML="",t.forEach(i=>{let b=document.createElement("button");b.type="button",b.setAttribute("data-value",i.dateItem),l===i.dateItem?b.className="date_btn active":b.className="date_btn",b.innerHTML=`
						<span class="self-stretch justify-center items-center inline-flex pointer-events-none">
							<span class="text-lg font-normal leading-normal">${i.label}</span>
						</span>
						<span class="self-stretch justify-center items-center inline-flex pointer-events-none">
							<span class="text-lg font-bold leading-normal">${i.date}</span>
						</span>
					`,b.addEventListener("click",()=>{this.value=i.dateItem,this.setAttribute("value",i.dateItem),this.dispatchEvent(new Event("change")),console.log("\u0412\u044B\u0431\u0440\u0430\u043D\u0430 \u0434\u0430\u0442\u0430:",i.date)}),q.appendChild(b)}),m.length>t.length?document.getElementById("show_calendar").classList.remove("hidden"):document.getElementById("show_calendar").classList.add("hidden")}document.querySelector(".tickets_addr_items").innerHTML=a,document.querySelector(".tickets_addr_items > *:first-child")?.click(),a||(document.querySelector(".tickets_addr_note").textContent="\u041D\u0435\u0442 \u0431\u0438\u043B\u0435\u0442\u043E\u0432")})})});document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",c=>{c.target.classList.contains("date_btn")&&document.querySelectorAll(".date_btn").forEach(a=>{console.log(a),document.querySelector('#order_form-page [type="date"]').value!==a.getAttribute("data-value")?a.classList.remove("active"):a.classList.add("active")})})});var Q=c=>["\u044F\u043D\u0432\u0430\u0440\u044F","\u0444\u0435\u0432\u0440\u0430\u043B\u044F","\u043C\u0430\u0440\u0442\u0430","\u0430\u043F\u0440\u0435\u043B\u044F","\u043C\u0430\u044F","\u0438\u044E\u043D\u044F","\u0438\u044E\u043B\u044F","\u0430\u0432\u0433\u0443\u0441\u0442\u0430","\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F","\u043E\u043A\u0442\u044F\u0431\u0440\u044F","\u043D\u043E\u044F\u0431\u0440\u044F","\u0434\u0435\u043A\u0430\u0431\u0440\u044F"][c-1]||"",Z=c=>{let l=["\u0412\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435","\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A","\u0412\u0442\u043E\u0440\u043D\u0438\u043A","\u0421\u0440\u0435\u0434\u0430","\u0427\u0435\u0442\u0432\u0435\u0440\u0433","\u041F\u044F\u0442\u043D\u0438\u0446\u0430","\u0421\u0443\u0431\u0431\u043E\u0442\u0430"],a=new Date(c);return l[a.getDay()]},_=c=>{let[l,a,t]=c.split("-");return`${parseInt(t)} ${Q(parseInt(a))}`};document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",c=>{let l=c.target;if(!l.classList.contains("tickets_addr_item"))return;document.querySelectorAll(".tickets_addr_item").forEach(y=>y.classList.remove("active")),l.classList.add("active");let a=l.dataset.ticks,t=l.dataset.a,m=l.dataset.crm,f=l.dataset.time,L=l.dataset.id;document.getElementById(t)?.click(),document.querySelector('[name="trip"]').value=L;let x=document.querySelector('[name="id_crm"]');x.value!==m&&(x.value=m,document.getElementById("order_form-page").dataset.crm=m,document.getElementById("all-prices").classList.add("loading"),fetch("/wp-json/custom/v1/get_current_prices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m})}).then(y=>y.json()).then(y=>{ee(y),console.log(y),document.getElementById("all-prices").classList.remove("loading")}).catch(y=>console.error("Error:",y))),document.querySelectorAll(".tickets_addr__note").forEach(y=>y.remove()),document.getElementById("date_and_time").value=document.querySelector("#order_form-page [type=date]").value+" "+f,document.querySelectorAll(".selected_info").forEach(function(y){y.innerHTML=_(document.querySelector("#order_form-page [type=date]").value)+", "+f})})});function ee(c){[{key:"adult",selector:".form__p_vzroslie",inputName:"price_adults"},{key:"adult_i",selector:".form__p_vzroslie_inostrancy",inputName:"price_adults_for"},{key:"kid",selector:".form__p_doshkolniki",inputName:"price_childs"},{key:"old",selector:".form__p_pensionery",inputName:"price_old"},{key:"school",selector:".form__p_shkolniki",inputName:"price_school"},{key:"student",selector:".form__p_studenty",inputName:"price_students"}].forEach(({key:a,selector:t,inputName:m})=>{let f=document.querySelector(t),L=document.querySelector(`[name="${m}"]`);c[a]&&(f.textContent=c[a][1]||c[a][0],f.parentElement.nextElementSibling.textContent=c[a][1]?`${c[a][0]} \u0440\u0443\u0431.`:"",L.value=c[a][1]||c[a][0])})}document.addEventListener("DOMContentLoaded",function(){let c=document.querySelectorAll(".search-form");c.forEach(l=>{let a=l.querySelector("input"),t=document.createElement("ul");t.className="search-results no-scrollbar",t.style.listStyle="none",t.style.padding="10px 15px",t.style.border="1px solid #ccc",t.style.maxWidth="100%",t.style.display="none",t.style.position="absolute",t.style.backgroundColor="white",t.style.zIndex="1000",t.style.top="35px",t.style.width="285px",t.style.left="0",t.style.minWidth="300px",t.style.maxHeight="400px",t.style.borderRadius="12px",t.style.overflowY="auto",l.appendChild(t),a.addEventListener("input",function(){let m=a.value.trim();if(m.length<2){t.style.display="none";return}fetch(`/wp-json/custom/v1/search-excursions?search=${encodeURIComponent(m)}`).then(f=>f.json()).then(f=>{if(t.innerHTML="",f.length===0){t.style.display="none";return}f.forEach(L=>{let x=document.createElement("li");x.style.padding="5px",x.style.cursor="pointer";let y=document.createElement("a");y.href=L.link,y.innerHTML=L.title,x.appendChild(y),t.appendChild(x)}),t.style.display="block"}).catch(f=>console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u0438\u0441\u043A\u0435:",f))})}),document.addEventListener("click",function(l){c.forEach(a=>{let t=a.querySelector(".search-results");t&&!a.contains(l.target)&&!t.contains(l.target)&&(t.style.display="none")})})});function X(){let c=0,l=0;document.querySelectorAll(".quantity-input").forEach(t=>{let m=t.parentElement.parentElement.previousElementSibling.querySelector(".price").textContent,f=t.parentElement.nextElementSibling.querySelector(".price"),L=parseInt(m,10),x=Number(t.value),y=x*L;f.textContent=y,console.log(f,y),l+=x,c+=y}),document.querySelector("[name=promo]").dispatchEvent(new Event("keyup")),document.querySelector("[name=true_price]").value=c,document.querySelector(".t_price").textContent=c;let a=te(l,["\u0431\u0438\u043B\u0435\u0442","\u0431\u0438\u043B\u0435\u0442\u0430","\u0431\u0438\u043B\u0435\u0442\u043E\u0432"]);document.querySelector(".tickets").textContent=l+" "+a}function te(c,l){return l[c%100>4&&c%100<20?2:[2,0,1,1,1,2][c%10<5?Math.abs(c)%10:5]]}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",c=>{if(c.target.closest(".increase-btn")){let l=c.target.closest("label");if(l){let a=l.querySelector(".quantity-input");if(a){let t=parseInt(a.value,10);t+=1,a.value=t}}X()}if(c.target.closest(".decrease-btn")){let l=c.target.closest("label");if(l){let a=l.querySelector(".quantity-input");if(a){let t=parseInt(a.value,10);t>0&&(t-=1,a.value=t)}}X()}if(c.target.id==="submit_buy"){let l=document.getElementById("order_form-page"),a=new FormData(l);fetch("/wp-json/custom/v1/add_ticket",{method:"POST",headers:{},body:a}).then(t=>t.ok?t.json():t.json().then(m=>{throw new Error(m.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(t=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",t)}).catch(t=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",t),alert(t.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})}})});})();
