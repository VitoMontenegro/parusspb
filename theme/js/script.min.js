(()=>{document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("input, textarea").forEach(e=>{e.addEventListener("focus",function(){this.dataset.placeholder=this.placeholder,this.placeholder=""}),e.addEventListener("blur",function(){this.placeholder=this.dataset.placeholder||""})});let n=document.getElementById("sidebar-menu"),s=window.scrollY;n&&(window.innerHeight<1270?window.addEventListener("scroll",()=>{window.scrollY>s?(n.classList.remove("lg:top-[40px]"),n.classList.add("lg:top-[calc(100vh-1270px)]")):(n.classList.remove("lg:top-[calc(100vh-1270px)]"),n.classList.add("lg:top-[40px]")),s=window.scrollY}):(n.classList.remove("lg:top-[calc(100vh-1270px)]"),n.classList.add("lg:top-[40px]")));let r=document.getElementById("menu-toggle"),t=document.getElementById("mobile-menu");r&&t&&(r.addEventListener("click",e=>{e.stopPropagation(),r.classList.contains("is-active")?(t.classList.remove("-translate-x-[1700px]"),t.classList.add("translate-x-0"),document.body.style.overflow="hidden"):(t.classList.remove("translate-x-0"),t.classList.add("-translate-x-[1700px]"),document.body.style.overflow=""),r.classList.toggle("is-active")}),document.addEventListener("click",e=>{!t.contains(e.target)&&!r.contains(e.target)&&(t.classList.remove("translate-x-0"),t.classList.add("-translate-x-[1700px]"),r.classList.add("is-active"),document.body.style.overflow="")}));let f=document.querySelectorAll(".sidebar-toggle"),m=document.getElementById("sidebar-menu");f.length&&m&&f.forEach(e=>{e.addEventListener("click",o=>{o.stopPropagation(),e.classList.contains("is-active")?(m.classList.remove("-translate-x-[1700px]"),m.classList.add("translate-x-0")):(m.classList.remove("translate-x-0"),m.classList.add("-translate-x-[1700px]")),e.classList.toggle("is-active")}),document.querySelectorAll(".close-filter-btn").forEach(o=>{o.addEventListener("click",()=>{e.classList.toggle("is-active"),m.classList.remove("translate-x-0"),m.classList.add("-translate-x-[1700px]")})}),document.addEventListener("click",o=>{!m.contains(o.target)&&!e.contains(o.target)&&(m.classList.remove("translate-x-0"),m.classList.add("-translate-x-[1700px]"),e.classList.add("is-active"))})});let h=new Swiper(".swiper_rev",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".rev-button-next",prevEl:".rev-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});h.on("init",()=>{document.querySelector(".rev-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".rev-button-next").classList.remove("swiper-button-disabled")}),h.init();let g=new Swiper(".swiper_similar",{slidesPerView:1,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".similar-button-next",prevEl:".similar-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});h.on("init",()=>{document.querySelector(".similar-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".similar-button-next").classList.remove("swiper-button-disabled")}),h.init();let y=new Swiper(".swiper_gids",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".gid-button-next",prevEl:".gid-button-prev"},breakpoints:{490:{slidesPerView:3.5,spaceBetween:32}}});y.on("init",()=>{document.querySelector(".gid-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".gid-button-next").classList.remove("swiper-button-disabled")}),y.init();let k=new Swiper(".swiper_custom",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}}),q=new Swiper(".swiper_four",{slidesPerView:1.2,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:24},1100:{slidesPerView:4,spaceBetween:24}}}),w=new Swiper(".swiper_five",{slidesPerView:1.2,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:24},1100:{slidesPerView:5,spaceBetween:24}}});if(document.querySelectorAll(".swiper_tour").length){let e=new Swiper(".mySwiper2",{spaceBetween:8,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}});document.querySelectorAll(".fancy-video img").forEach(a=>{let c=a.getAttribute("src"),l=a.getAttribute("alt"),d=a.getAttribute("data-video-id"),i=a.getAttribute("data-video-type");if(!d)a.setAttribute("data-src",c),a.setAttribute("data-caption",l);else{let u="";i==="youtube"?u=`https://www.youtube.com/embed/${d}?autoplay=1`:i==="rutube"?u=`https://rutube.ru/play/embed/${d}?autoplay=1`:i==="dzen"&&(u=d),a.setAttribute("data-fancybox","gallery"),a.setAttribute("data-src",u),a.setAttribute("data-caption",l)}}),Fancybox.bind('[data-fancybox="gallery"]',{infinite:!0,groupAll:!0,caption:function(a,c,l){return l.alt}})}if(document.querySelectorAll(".swiper_block")){let e=new Swiper(".swiperBlock",{slidesPerView:2.2,spaceBetween:11,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{490:{slidesPerView:2.2,spaceBetween:11},790:{slidesPerView:3,spaceBetween:24},1023:{slidesPerView:5,spaceBetween:24}}})}if(document.querySelectorAll(".swiper_small")){let e=new Swiper(".swiper_small",{slidesPerView:1.5,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".rev-button-next",prevEl:".rev-button-prev"},breakpoints:{490:{slidesPerView:4,spaceBetween:24}}})}let A=null,p=flatpickr("#calendar",{inline:!0,mode:"range",minDate:"today",dateFormat:"Y-m-d",locale:"ru",onChange:function(e,o,a){A={dates:e,range:o},document.querySelectorAll(".flatpickr-day.confirmed-range").forEach(c=>{c.classList.remove("confirmed-range")}),e.length===2&&setTimeout(()=>{document.querySelectorAll(".flatpickr-day.inRange").forEach(c=>{c.classList.add("confirmed-range")})},10)}}),b=document.getElementById("okBtn"),$=document.getElementById("cancelBtn");b&&$&&(b.addEventListener("click",function(){A&&A.dates.length?(document.querySelector('input[name="dateForm"]').value=A.range,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0}))):alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D \u0434\u0430\u0442!")}),$.addEventListener("click",function(){A=null,p.clear(),j(),N(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(e=>{let o=window.location.origin+window.location.pathname;e.href=o.toString()})}));function V(){document.querySelectorAll(".calendar-wrapper").forEach(e=>{let o=e.querySelector(".calendar"),a=e.getAttribute("data-dates"),c=a?JSON.parse(a):[],l=flatpickr(o,{inline:!0,minDate:"today",dateFormat:"Y-m-d",locale:"ru",defaultDate:c,clickOpens:!1,enable:c,onReady:function(){o.querySelectorAll(".flatpickr-day").forEach(i=>{let u=i.getAttribute("aria-label");c.includes(u)&&i.classList.add("selected")})},onChange:function(){l.setDate(c,!1)}})})}if(V(),document.addEventListener("click",function(e){e.target.id==="cancelBtnFilter"&&(A=null,p.clear(),j(),N(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(a=>{let c=window.location.origin+window.location.pathname;a.href=c.toString()}))}),document.addEventListener("click",function(e){let o=document.querySelectorAll(".dropdown-button"),a=document.querySelectorAll(".dropdown-menu"),c=e.target.closest(".dropdown-button");if(c){let i=Array.from(o).indexOf(c),u=a[i];if(!u)return;let E=u.classList.contains("hidden");a.forEach((v,L)=>{L!==i&&(v.classList.add("hidden"),o[L].setAttribute("aria-expanded","false"))}),E?(u.classList.remove("hidden"),c.setAttribute("aria-expanded","true")):(u.classList.add("hidden"),c.setAttribute("aria-expanded","false"));return}let l=e.target.closest(".dropdown-menu .item");if(l){let i=l.closest(".dropdown-menu"),u=document.querySelector('.dropdown-button[aria-expanded="true"]');i&&u&&(i.classList.add("hidden"),u.setAttribute("aria-expanded","false"));return}let d=e.target.closest(".dropdown-menu .close-menu");if(d){let i=d.closest(".dropdown-menu"),u=document.querySelector('.dropdown-button[aria-expanded="true"]');i&&u&&(i.classList.add("hidden"),u.setAttribute("aria-expanded","false"));return}a.forEach((i,u)=>{!i.contains(e.target)&&!o[u].contains(e.target)&&(i.classList.add("hidden"),o[u].setAttribute("aria-expanded","false"))})}),document.getElementById("category_id")){let o=function(){let a=v=>Array.from(document.querySelectorAll(`#filter-form input[name="${v}"]:checked, #sort_form input[name="${v}"]:checked`)).map(L=>L.value),c=a("duration"),l=a("price"),d=-1,i=a("grade_sort"),u=document.querySelector('input[name="dateForm"]').value??null,E=new URLSearchParams({grade_sort:JSON.stringify(i),price:JSON.stringify(l),duration:JSON.stringify(c),dateForm:u,posts_per_page:d,category_id:e});document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(v=>{let L=new URL(v.href);u&&L.searchParams.set("dateForm",u),l&&L.searchParams.set("price",JSON.stringify(l)),c&&L.searchParams.set("duration",JSON.stringify(c)),v.href=L.toString()}),fetch("/wp-json/my_namespace/v1/filter-posts/?"+E.toString()).then(v=>{if(!v.ok)throw new Error("Failed to fetch the template.");return v.json()}).then(v=>{document.getElementById("tours").innerHTML=v.data.html,document.getElementById("card_link").scrollIntoView({block:"start",behavior:"smooth"}),V(),J();let L=document.querySelectorAll(".sidebar-toggle"),S=document.getElementById("sidebar-menu");L.length&&S&&(L.forEach(B=>{B.classList.toggle("is-active")}),S.classList.remove("translate-x-0"),S.classList.add("-translate-x-[1700px]"))}).catch(v=>console.error("Error loading posts:",v))};var oe=o;let e=document.getElementById("category_id").value;document.getElementById("filter-form").addEventListener("change",function(){o()}),document.getElementById("sort_form").addEventListener("change",function(){o()})}function j(){let e=document.getElementById("filter-form");Array.from(e.elements).forEach(o=>{switch(o.type){case"text":case"textarea":case"password":case"email":case"url":case"number":case"search":case"tel":case"hidden":o.value="";break;case"checkbox":case"radio":o.checked=!1;break;case"select-one":case"select-multiple":o.selectedIndex=-1;break;default:break}})}function N(){let e=window.location.origin+window.location.pathname;window.history.replaceState({},document.title,e)}function R(e){return e.trim()?/^(\+7|8)?[\s-]?(\(?\d{3}\)?)?[\s-]?\d{3}[\s-]?\d{2}[\s-]?\d{2}$/.test(e.trim()):!1}let H=document.querySelector(".reviews_form");if(H){document.querySelectorAll(".list-input input[name]").forEach(c=>{let l=c.nextElementSibling;if(!l)return;let d=()=>{l.classList.remove("hidden")},i=()=>{l.classList.add("hidden")};c.addEventListener("focus",d),c.addEventListener("input",()=>{let u=c.value.toLowerCase();l.querySelectorAll(".data-item").forEach(E=>{let v=E.textContent.toLowerCase();E.style.display=v.includes(u)?"block":"none"}),d()}),l.addEventListener("mousedown",u=>{let E=u.target.closest(".data-item");E&&(c.value=E.textContent,E.classList.contains("suggestions")&&(document.querySelector('input[name="excurs"]').value=E.getAttribute("data-name")),i())}),document.addEventListener("click",u=>{!c.contains(u.target)&&!l.contains(u.target)&&i()})});let e=document.getElementById("photo-input"),o=document.getElementById("preview-container"),a=[];e.addEventListener("change",c=>{Array.from(c.target.files||[]).forEach(d=>{if(!d.type.startsWith("image/"))return;let i=new FileReader;i.onload=u=>{let E=document.createElement("div");E.classList.add("preview");let v=document.createElement("img");v.src=u.target?.result;let L=document.createElement("button");L.innerText="\xD7",L.onclick=()=>{let S=a.indexOf(d);S>-1&&a.splice(S,1),o.removeChild(E)},E.appendChild(v),E.appendChild(L),o.appendChild(E)},i.readAsDataURL(d),a.push(d)}),e.value=""}),H.addEventListener("submit",function(c){c.preventDefault();let l=this.querySelector(".send-btn"),d=l.querySelector(".btn-text"),i=l.querySelector(".loader"),u=c.target,E=u.querySelector("[name=name]").value,v=new FormData(u);a.forEach((S,B)=>{v.append(`file[${B}]`,S)});let L=document.querySelector(".name_field input");if(E)L.classList.remove("alert"),l.disabled=!0,d.classList.add("hidden"),i.classList.remove("hidden");else return L.classList.add("alert"),window.scrollTo({top:document.querySelector(".reviews_form").offsetTop-50,behavior:"smooth"}),!1;setTimeout(()=>{let S=document.querySelector('.popup[data-popup="popup-success-rev"]');S&&S.classList.remove("hidden"),l.disabled=!1,d.classList.remove("hidden"),i.classList.add("hidden")},2500),fetch("/wp-json/custom/v1/reviews-form",{method:"POST",headers:{},body:v}).then(S=>S.ok?S.json():S.json().then(B=>{throw new Error(B.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(S=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",S)}).catch(S=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",S)}).finally(()=>{u.reset(),a.length=0,o.innerHTML=""})})}document.querySelectorAll(".send-letter").forEach(e=>{e.addEventListener("submit",function(o){o.preventDefault();let a=o.target,c=a.getAttribute("data-api"),l=new FormData(a),d=a.querySelector('input[name="tel"]');if(d){let i=l.get("tel");if(R(i))R(i)&&d.classList.remove("border","border-[#FF7A45]");else return d.classList.add("border","border-[#FF7A45]"),!1}c&&fetch(`/wp-json/custom/v1/${c}`,{method:"POST",headers:{},body:l}).then(i=>i.ok?i.json():i.json().then(u=>{throw new Error(u.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(i=>{if(!i.success)throw new Error(i.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B");return a.reset(),X(),document.querySelector(".popup[data-popup='popup-success']").classList.remove("hidden"),!0}).catch(i=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",i),alert(i.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})})}),document.querySelectorAll("[data-open]").forEach(e=>{e.addEventListener("click",function(){let o=e.getAttribute("data-open"),a=document.querySelector(`.popup[data-popup="${o}"]`);a&&a.classList.remove("hidden")})});function ne(e){e.classList.remove("hidden")}function X(){document.querySelectorAll(".popup-close").forEach(e=>{let o=e.closest(".popup");o&&o.classList.add("hidden")})}document.querySelectorAll(".popup-close").forEach(e=>{e.addEventListener("click",function(){let o=e.closest(".popup");o&&o.classList.add("hidden")})}),document.querySelectorAll(".popup").forEach(e=>{e.addEventListener("click",function(o){if(o.target===e){e.classList.add("hidden");let a=e.querySelector(".popup-media-container");a&&(a.innerHTML="")}})}),document.querySelectorAll(".togler").forEach(e=>{e.textContent="\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432",e.addEventListener("click",()=>{e.textContent=e.textContent==="\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432"?"\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C \u043E\u0442\u0437\u044B\u0432":"\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432";let o=e.closest(".text_toggle").querySelector(".rev-text");o&&(o.classList.toggle("long-rev"),o.classList.toggle("short-rev"))})});function J(){let e=document.getElementById("response");if(!e)return;let o=e.querySelectorAll(".wish-btn");if(a(o),e.dataset.initialized)return;e.dataset.initialized=!0,e.addEventListener("click",l=>{let d=l.target.closest(".wish-btn");d&&c(d)});function a(l){let d=P("product");try{d=d?JSON.parse(d):[]}catch(i){console.error("Error parsing cookies:",i),d=[]}l.forEach(i=>{let u=i.getAttribute("data-wp-id");d.includes(u)&&i.classList.add("active")})}function c(l){let d=P("product");try{d=d?JSON.parse(d):[]}catch(u){console.error("Error parsing cookies:",u),d=[]}let i=l.getAttribute("data-wp-id");d.includes(i)?(d=d.filter(u=>u!==i),l.classList.remove("active")):(d.push(i),l.classList.add("active")),G("product",JSON.stringify(d),7),Y("product","#product-count span","#product-count div")}}J();function Y(e,o,a){let c=P(e);if(c)try{let l=JSON.parse(c);Array.isArray(l)&&(document.querySelector(o).textContent=l.length,l.length<1?document.querySelector(a).style.visibility="hidden":document.querySelector(a).style.visibility="visible")}catch(l){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0435 \u043A\u0443\u043A\u0438 '"+e+"':",l)}else document.querySelector(o).textContent=0}Y("product","#product-count span","#product-count div");function P(e){let o=document.cookie.split(";");for(let a=0;a<o.length;a++){let c=o[a].trim();if(c.startsWith(e+"="))return c.substring(e.length+1)}return null}function G(e,o,a){let c=new Date;c.setTime(c.getTime()+a*24*60*60*1e3);let l="expires="+c.toUTCString();document.cookie=e+"="+o+";"+l+";path=/"}document.body.addEventListener("click",function(e){if(e.target.classList.contains("delete")){let o=Array.from(document.querySelectorAll(".delete")).indexOf(e.target);console.log("\u0423\u0434\u0430\u043B\u044F\u0435\u043C \u0444\u0430\u0439\u043B:",o),filestoupload.splice(o,1),e.target.parentElement.remove(),console.log("Files to upload:",filestoupload.length)}}),window.addEventListener("scroll",function(){if(window.innerWidth>=1024)return;let e=document.getElementById("card_link"),o=document.getElementById("sticky-element");if(!e||!o)return;let a=e.getBoundingClientRect();a.top<=0&&a.bottom>=1e3?(o.classList.add("fixed"),o.classList.remove("hidden")):(o.classList.remove("fixed"),o.classList.add("hidden"))});let D=document.querySelectorAll(".int_mesta .item"),C=document.querySelector(".show-more");D.length&&C&&(D.length>6&&C.classList.remove("hidden"),C.addEventListener("click",function(){D.forEach(e=>e.classList.remove("hidden")),C.classList.add("hidden")}));let x=document.querySelector(".g-scrolling-carousel .overflow-x-auto");if(x){let e=!1,o,a;x.addEventListener("wheel",function(c){c.preventDefault(),x.scrollLeft+=c.deltaY}),x.addEventListener("mousedown",function(c){e=!0,o=c.pageX-x.offsetLeft,a=x.scrollLeft}),x.addEventListener("mouseleave",function(){e=!1}),x.addEventListener("mouseup",function(){e=!1}),x.addEventListener("mousemove",function(c){if(!e)return;c.preventDefault();let d=(c.pageX-x.offsetLeft-o)*3;x.scrollLeft=a-d})}let T=document.getElementById("scrollToTop");window.addEventListener("scroll",function(){window.scrollY>=800?T.classList.remove("hidden","opacity-0"):T.classList.add("hidden","opacity-0")}),T.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})});document.addEventListener("DOMContentLoaded",()=>{async function n(){let s=document.getElementById("order_form-page");if(s&&s.dataset.crm){let r=s.dataset.crm;fetch("/wp-json/custom/v1/tour_tickets?id="+r,{method:"POST",headers:{"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445");return t.json()}).then(t=>{window.dates=t;let f=document.querySelector('#order_form-page [type="date"]');f&&(f.value=window.dates.min_date,f.setAttribute("value",window.dates.min_date),f.setAttribute("min",window.dates.min_date),f.setAttribute("max",window.dates.max_date),f.dispatchEvent(new Event("change"))),document.dispatchEvent(new Event("dates_loaded",{bubbles:!0}))}).catch(t=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",t)})}}n().then(()=>{document.querySelector('#order_form-page [type="date"]')?.addEventListener("change",function(){let s=this.value,r="",t=[],f=[],m=[];if(window.dates&&window.dates.dates){window.dates.dates.forEach(p=>{m.includes(p.date)||(m.push(p.date),f.push(p)),s===p.date&&(p.time===p.a1||!p.a1||p.a1==="undefined")&&(r+=`<button type="button" class="time_btn tickets_addr_item" data-id="${p.id}"  data-crm="${p.tour_id}" data-time="${p.time}" data-ticks="${p.tickets}" data-a="a1"> ${p.time} </button>`)});let h=new Date,g=new Date;g.setDate(h.getDate()+1);let y=new Date;y.setDate(h.getDate()+2);let k=_(h.toISOString().split("T")[0]),q=_(g.toISOString().split("T")[0]),w=_(y.toISOString().split("T")[0]),I=f.some(p=>_(p.date)===k),F=f.some(p=>_(p.date)===q),M=f.some(p=>_(p.date)===w);if(I){let p=f.find(b=>_(b.date)===k);t.push({label:"\u0421\u0435\u0433\u043E\u0434\u043D\u044F",date:_(p.date),dateItem:p.date})}if(F){let p=f.find(b=>_(b.date)===q);t.push({label:"\u0417\u0430\u0432\u0442\u0440\u0430",date:_(p.date),dateItem:p.date})}if(M){let p=f.find(b=>_(b.date)===w);t.push({label:"\u041F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430",date:_(p.date),dateItem:p.date})}f.slice(t.length,t.length+3).forEach(p=>{t.length<3&&t.push({label:K(p.date),date:_(p.date),dateItem:p.date})}),flatpickr("#calendarSelected",{inline:!0,minDate:"today",dateFormat:"Y-m-d",locale:"ru",enable:m,onChange:function(p,b){document.querySelector('#order_form-page [type="date"]').value=b,document.querySelector('#order_form-page [type="date"]').setAttribute("value",b),document.querySelector('#order_form-page [type="date"]').dispatchEvent(new Event("change"))}});let A=document.getElementById("dateButtonsContainer");A.innerHTML="",t.forEach(p=>{let b=document.createElement("button");b.type="button",b.setAttribute("data-value",p.dateItem),s===p.dateItem?b.className="date_btn active":b.className="date_btn",b.innerHTML=`
						<span class="self-stretch justify-center items-center inline-flex pointer-events-none">
							<span class="text-lg font-normal leading-normal">${p.label}</span>
						</span>
						<span class="self-stretch justify-center items-center inline-flex pointer-events-none">
							<span class="text-lg font-bold leading-normal">${p.date}</span>
						</span>
					`,b.addEventListener("click",()=>{this.value=p.dateItem,this.setAttribute("value",p.dateItem),this.dispatchEvent(new Event("change")),console.log("\u0412\u044B\u0431\u0440\u0430\u043D\u0430 \u0434\u0430\u0442\u0430:",p.date)}),A.appendChild(b)}),f.length>t.length?document.getElementById("show_calendar").classList.remove("hidden"):document.getElementById("show_calendar").classList.add("hidden")}document.querySelector(".tickets_addr_items").innerHTML=r,document.querySelector(".tickets_addr_items > *:first-child")?.click(),r||(document.querySelector(".tickets_addr_note").textContent="\u041D\u0435\u0442 \u0431\u0438\u043B\u0435\u0442\u043E\u0432")})})});document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",n=>{n.target.classList.contains("date_btn")&&document.querySelectorAll(".date_btn").forEach(r=>{console.log(r),document.querySelector('#order_form-page [type="date"]').value!==r.getAttribute("data-value")?r.classList.remove("active"):r.classList.add("active")})})});var U=n=>["\u044F\u043D\u0432\u0430\u0440\u044F","\u0444\u0435\u0432\u0440\u0430\u043B\u044F","\u043C\u0430\u0440\u0442\u0430","\u0430\u043F\u0440\u0435\u043B\u044F","\u043C\u0430\u044F","\u0438\u044E\u043D\u044F","\u0438\u044E\u043B\u044F","\u0430\u0432\u0433\u0443\u0441\u0442\u0430","\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F","\u043E\u043A\u0442\u044F\u0431\u0440\u044F","\u043D\u043E\u044F\u0431\u0440\u044F","\u0434\u0435\u043A\u0430\u0431\u0440\u044F"][n-1]||"",K=n=>{let s=["\u0412\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435","\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A","\u0412\u0442\u043E\u0440\u043D\u0438\u043A","\u0421\u0440\u0435\u0434\u0430","\u0427\u0435\u0442\u0432\u0435\u0440\u0433","\u041F\u044F\u0442\u043D\u0438\u0446\u0430","\u0421\u0443\u0431\u0431\u043E\u0442\u0430"],r=new Date(n);return s[r.getDay()]},_=n=>{let[s,r,t]=n.split("-");return`${parseInt(t)} ${U(parseInt(r))}`},Q=n=>{let[s,r,t]=n.split("-");return`${parseInt(t)} ${U(parseInt(r))} ${s}`};document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",n=>{let s=n.target;if(!s.classList.contains("tickets_addr_item"))return;document.querySelectorAll(".tickets_addr_item").forEach(y=>y.classList.remove("active")),s.classList.add("active");let r=s.dataset.ticks,t=s.dataset.a,f=s.dataset.crm,m=s.dataset.time,h=s.dataset.id;document.getElementById(t)?.click(),document.querySelector('[name="trip"]').value=h;let g=document.querySelector('[name="id_crm"]');g.value!==f&&(g.value=f,document.getElementById("order_form-page").dataset.crm=f,document.getElementById("all-prices").classList.add("loading"),fetch("/wp-json/custom/v1/get_current_prices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:f})}).then(y=>y.json()).then(y=>{Z(y),document.getElementById("all-prices").classList.remove("loading")}).catch(y=>console.error("Error:",y))),document.querySelectorAll(".tickets_addr__note").forEach(y=>y.remove()),document.getElementById("date_and_time").value=document.querySelector("#order_form-page [type=date]").value+" "+m,document.querySelectorAll(".selected_info").forEach(function(y){y.innerHTML=_(document.querySelector("#order_form-page [type=date]").value)+", "+m}),document.querySelectorAll(".selected_info_full").forEach(function(y){y.innerHTML=Q(document.querySelector("#order_form-page [type=date]").value)+", "+m})})});function Z(n){[{key:"adult",selector:".form__p_vzroslie",inputName:"price_adults"},{key:"adult_i",selector:".form__p_vzroslie_inostrancy",inputName:"price_adults_for"},{key:"kid",selector:".form__p_doshkolniki",inputName:"price_childs"},{key:"old",selector:".form__p_pensionery",inputName:"price_old"},{key:"school",selector:".form__p_shkolniki",inputName:"price_school"},{key:"student",selector:".form__p_studenty",inputName:"price_students"}].forEach(({key:r,selector:t,inputName:f})=>{let m=document.querySelector(t),h=document.querySelector(`[name="${f}"]`);n[r]&&(m.textContent=n[r][1]||n[r][0],m.parentElement.nextElementSibling.textContent=n[r][1]?`${n[r][0]} \u0440\u0443\u0431.`:"",h.value=n[r][1]||n[r][0])})}document.addEventListener("DOMContentLoaded",function(){let n=document.querySelectorAll(".search-form");n.forEach(s=>{let r=s.querySelector("input"),t=document.createElement("ul");t.className="search-results no-scrollbar",t.style.listStyle="none",t.style.padding="10px 15px",t.style.border="1px solid #ccc",t.style.maxWidth="100%",t.style.display="none",t.style.position="absolute",t.style.backgroundColor="white",t.style.zIndex="1000",t.style.top="38px",t.style.width="285px",t.style.left="0",t.style.minWidth="300px",t.style.maxHeight="400px",t.style.borderRadius="12px",t.style.overflowY="auto",s.appendChild(t),r.addEventListener("input",function(){let f=r.value.trim();if(f.length<2){t.style.display="none";return}fetch(`/wp-json/custom/v1/search-excursions?search=${encodeURIComponent(f)}`).then(m=>m.json()).then(m=>{if(t.innerHTML="",m.length===0){t.style.display="none";return}m.forEach(h=>{let g=document.createElement("li");g.style.padding="5px",g.style.cursor="pointer";let y=document.createElement("a");y.href=h.link,y.innerHTML=h.title,g.appendChild(y),t.appendChild(g)}),t.style.display="block"}).catch(m=>console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u0438\u0441\u043A\u0435:",m))})}),document.addEventListener("click",function(s){n.forEach(r=>{let t=r.querySelector(".search-results");t&&!r.contains(s.target)&&!t.contains(s.target)&&(t.style.display="none")})})});function W(){let n=0,s=0;document.querySelectorAll(".quantity-input").forEach(t=>{let f=t.parentElement.parentElement.previousElementSibling.querySelector(".price").textContent,m=t.parentElement.nextElementSibling.querySelector(".price"),h=parseInt(f,10),g=Number(t.value),y=g*h;m.textContent=y,s+=g,n+=y}),document.querySelector("[name=promo]").dispatchEvent(new Event("keyup")),document.querySelector("[name=true_price]").value=n,document.querySelector("[name=amount]").value=n??0,document.querySelector(".t_price").textContent=n??0;let r=ee(s,["\u0431\u0438\u043B\u0435\u0442","\u0431\u0438\u043B\u0435\u0442\u0430","\u0431\u0438\u043B\u0435\u0442\u043E\u0432"]);document.querySelector(".tickets").textContent=s+" "+r,O()}function ee(n,s){return s[n%100>4&&n%100<20?2:[2,0,1,1,1,2][n%10<5?Math.abs(n)%10:5]]}function O(){let n=document.querySelector('[name="20percent"]:checked');if(n&&n.value==="on"){let r=parseFloat(document.querySelector(".t_price").textContent)*.3;document.querySelector(".total-sale_price_count").textContent=Math.round(r),document.querySelector(".total-sale_price").classList.remove("hidden")}else document.querySelector(".total-sale_price").classList.add("hidden")}function z(){let n=document.querySelector("#order_form-page");document.querySelectorAll(".error_form_mes").forEach(w=>w.remove());let s=n.querySelector("[name=phone]").value.trim(),r=n.querySelector("[name=name]").value.trim(),t=n.querySelector("[name=mail]").value.trim(),f=0,m=0,h=/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/,g=/^[\w-\.]+@[\w-]+\.[a-z]{2,4}$/i,y=h.test(s),k=g.test(t),q=document.querySelector(".tours-content__form-title + .text-red");if(q&&q.remove(),document.querySelectorAll(".quantity-input").forEach(w=>{f+=parseInt(w.value)||0}),f===0){let w=document.createElement("div");w.className="text-red",w.textContent="\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043B-\u0432\u043E \u0431\u0438\u043B\u0435\u0442\u043E\u0432",document.querySelector(".tours-content__form-title").after(w),m=1}else document.querySelectorAll(".error_form_mes_time.ch_count").forEach(w=>w.remove());if(r)document.querySelector(".fio_field").classList.remove("alert");else{let w=document.createElement("div");w.className="error_form_mes error_form_mes_time fio",w.textContent="\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u043F\u043E\u043B\u0435",document.querySelector(".fio_field").classList.add("alert"),m=1}return s&&y?document.querySelector(".phones_field").classList.remove("alert"):(document.querySelector(".phones_field").classList.add("alert"),m=1),t&&k?document.querySelector(".email_field").classList.remove("alert"):(document.querySelector(".email_field").classList.add("alert"),m=1),m}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",n=>{if(n.target.closest(".increase-btn")){let s=n.target.closest("label");if(s){let r=s.querySelector(".quantity-input");if(r){let t=parseInt(r.value,10);t+=1,r.value=t}}W()}if(n.target.matches('[name="20percent"]')&&O(),n.target.closest(".decrease-btn")){let s=n.target.closest("label");if(s){let r=s.querySelector(".quantity-input");if(r){let t=parseInt(r.value,10);t>0&&(t-=1,r.value=t)}}W()}if(n.target.id==="submit_buy"){if(z())return;let s=document.getElementById("order_form-page"),r=new FormData(s),t=n.target,f=t.querySelector(".btn-text"),m=t.querySelector(".loader");console.log(t),t.disabled=!0,f.classList.add("hidden"),m.classList.remove("hidden"),fetch("/wp-content/themes/tw/theme/handler/buy_form.php",{method:"POST",headers:{},body:r}).then(h=>h.ok?h.json():h.json().then(g=>{throw new Error(g.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(h=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",h);let g=document.querySelector("#order_form-page");g.action=h.pay_url,g.submit()}).catch(h=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",h),alert(h.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{t.disabled=!1,f.classList.remove("hidden"),m.classList.add("hidden")})}if(n.target.id==="submit_request"){if(z())return;let s=n.target,r=s.querySelector(".btn-text"),t=s.querySelector(".loader");s.disabled=!0,r.classList.add("hidden"),t.classList.remove("hidden");let f=document.getElementById("order_form-page"),m=new FormData(f);fetch("/wp-content/themes/tw/theme/handler/order_form.php",{method:"POST",headers:{},body:m}).then(h=>h.ok?h.json():h.json().then(g=>{throw new Error(g.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(h=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",h),setTimeout(()=>{let g=document.querySelector('.popup[data-popup="popup-success-order"]');g&&g.classList.remove("hidden"),document.getElementById("order_form-page").reset(),s.disabled=!1,r.classList.remove("hidden"),t.classList.add("hidden")},10)}).catch(h=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",h),alert(h.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{s.disabled=!1,r.classList.remove("hidden"),t.classList.add("hidden")})}})});document.addEventListener("DOMContentLoaded",()=>{let n=document.querySelector("[name=promo]"),s=document.querySelector(".promo-loader"),r=document.getElementById("promo_ok"),t;n&&(n.addEventListener("keyup",()=>{n.value?(s.classList.add("active"),clearTimeout(t),t=setTimeout(()=>f(n.value),2e3),r.style.display="none"):s.classList.remove("active")}),n.addEventListener("keydown",()=>{clearTimeout(t)}),n.addEventListener("change",()=>{n.value||(s.classList.remove("active"),r.style.display="none")}));async function f(m){let h=document.getElementById("order_form-page");if(h){let g=new FormData(h);g.append("promo",m);try{let k=await(await fetch("/wp-content/themes/tw/theme/handler/validate_promo.php",{method:"POST",body:g})).json();if(s.classList.remove("active"),k.ok){let q=parseInt(k.minus);document.getElementById("discount").dataset.fulldiscount=q;let w=document.querySelector("[name=amount]"),I=parseInt(w.value)-q;w.value=I,document.querySelector(".t_price").textContent=I,r.textContent=`\u041F\u0440\u043E\u043C\u043E\u043A\u043E\u0434 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u0435\u043D, \u0441\u043A\u0438\u0434\u043A\u0430 ${q} \u0440\u0443\u0431\u043B\u0435\u0439.`,r.style.color="green",r.style.display="block",n.readOnly=!0,O()}else r.textContent=k.msg||"\u041F\u0440\u043E\u043C\u043E\u043A\u043E\u0434 \u043D\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u0435\u043D.",r.style.color="red",r.style.display="block"}catch(y){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u043F\u0440\u043E\u0441\u0430!!:",y)}}}});document.addEventListener("DOMContentLoaded",function(){let n=document.getElementById("cookie-banner"),s=document.getElementById("accept-cookies"),r=!1;n&&s&&(localStorage.getItem("cookiesAccepted")||n.classList.remove("hidden"),document.addEventListener("mousedown",function(t){r=t.isTrusted}),s.addEventListener("click",function(t){localStorage.setItem("cookiesAccepted","true"),n.classList.add("hidden"),t.stopPropagation()}),document.addEventListener("click",function(t){r&&!n.contains(t.target)&&(localStorage.setItem("cookiesAccepted","true"),n.classList.add("hidden"),t.stopPropagation()),r=!1}))});})();
