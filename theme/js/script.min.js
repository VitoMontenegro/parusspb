(()=>{document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("input, textarea").forEach(e=>{e.addEventListener("focus",function(){this.dataset.placeholder=this.placeholder,this.placeholder=""}),e.addEventListener("blur",function(){this.placeholder=this.dataset.placeholder||""})});let c=document.getElementById("sidebar-menu"),i=window.scrollY;c&&window.addEventListener("scroll",()=>{window.scrollY>i?(c.classList.remove("lg:top-[40px]"),c.classList.add("lg:top-[-400px]")):(c.classList.remove("lg:top-[-400px]"),c.classList.add("lg:top-[40px]")),i=window.scrollY});let a=document.getElementById("menu-toggle"),t=document.getElementById("mobile-menu");a&&t&&(a.addEventListener("click",e=>{e.stopPropagation(),a.classList.contains("is-active")?(t.classList.remove("-translate-x-[1700px]"),t.classList.add("translate-x-0"),document.body.style.overflow="hidden"):(t.classList.remove("translate-x-0"),t.classList.add("-translate-x-[1700px]"),document.body.style.overflow=""),a.classList.toggle("is-active")}),document.addEventListener("click",e=>{!t.contains(e.target)&&!a.contains(e.target)&&(t.classList.remove("translate-x-0"),t.classList.add("-translate-x-[1700px]"),a.classList.add("is-active"),document.body.style.overflow="")}));let p=document.querySelectorAll(".sidebar-toggle"),f=document.getElementById("sidebar-menu");p.length&&f&&p.forEach(e=>{e.addEventListener("click",n=>{n.stopPropagation(),e.classList.contains("is-active")?(f.classList.remove("-translate-x-[1700px]"),f.classList.add("translate-x-0")):(f.classList.remove("translate-x-0"),f.classList.add("-translate-x-[1700px]")),e.classList.toggle("is-active")}),document.querySelectorAll(".close-filter-btn").forEach(n=>{n.addEventListener("click",()=>{e.classList.toggle("is-active"),f.classList.remove("translate-x-0"),f.classList.add("-translate-x-[1700px]")})}),document.addEventListener("click",n=>{!f.contains(n.target)&&!e.contains(n.target)&&(f.classList.remove("translate-x-0"),f.classList.add("-translate-x-[1700px]"),e.classList.add("is-active"))})});let L=new Swiper(".swiper_rev",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".rev-button-next",prevEl:".rev-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});L.on("init",()=>{document.querySelector(".rev-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".rev-button-next").classList.remove("swiper-button-disabled")}),L.init();let x=new Swiper(".swiper_similar",{slidesPerView:1,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".similar-button-next",prevEl:".similar-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});L.on("init",()=>{document.querySelector(".similar-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".similar-button-next").classList.remove("swiper-button-disabled")}),L.init();let y=new Swiper(".swiper_gids",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".gid-button-next",prevEl:".gid-button-prev"},breakpoints:{490:{slidesPerView:3.5,spaceBetween:32}}});y.on("init",()=>{document.querySelector(".gid-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".gid-button-next").classList.remove("swiper-button-disabled")}),y.init();let C=new Swiper(".swiper_custom",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}}),D=new Swiper(".swiper_four",{slidesPerView:1.2,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:24},1100:{slidesPerView:4,spaceBetween:24}}}),T=new Swiper(".swiper_five",{slidesPerView:1.2,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:24},1100:{slidesPerView:5,spaceBetween:24}}});if(document.querySelectorAll(".swiper_tour").length){let e=new Swiper(".mySwiper2",{spaceBetween:8,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}});document.querySelectorAll(".fancy-video img").forEach(o=>{let l=o.getAttribute("src"),m=o.getAttribute("alt"),u=o.getAttribute("data-video-id"),s=o.getAttribute("data-video-type");if(!u)o.setAttribute("data-src",l),o.setAttribute("data-caption",m);else{let r="";s==="youtube"?r=`https://www.youtube.com/embed/${u}?autoplay=1`:s==="rutube"?r=`https://rutube.ru/play/embed/${u}?autoplay=1`:s==="dzen"&&(r=u),o.setAttribute("data-fancybox","gallery"),o.setAttribute("data-src",r),o.setAttribute("data-caption",m)}}),Fancybox.bind('[data-fancybox="gallery"]',{infinite:!0,groupAll:!0,caption:function(o,l,m){return m.alt}})}if(document.querySelectorAll(".swiper_block")){let e=new Swiper(".swiperBlock",{slidesPerView:2.2,spaceBetween:11,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{490:{slidesPerView:2.2,spaceBetween:11},790:{slidesPerView:3,spaceBetween:24},1023:{slidesPerView:5,spaceBetween:24}}})}if(document.querySelectorAll(".swiper_small")){let e=new Swiper(".swiper_small",{slidesPerView:1.5,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".rev-button-next",prevEl:".rev-button-prev"},breakpoints:{490:{slidesPerView:4,spaceBetween:24}}})}let q=null,d=flatpickr("#calendar",{inline:!0,mode:"range",minDate:"today",dateFormat:"Y-m-d",locale:"ru",onChange:function(e,n,o){q={dates:e,range:n},document.querySelectorAll(".flatpickr-day.confirmed-range").forEach(l=>{l.classList.remove("confirmed-range")}),e.length===2&&setTimeout(()=>{document.querySelectorAll(".flatpickr-day.inRange").forEach(l=>{l.classList.add("confirmed-range")})},10)}}),b=document.getElementById("okBtn"),N=document.getElementById("cancelBtn");b&&N&&(b.addEventListener("click",function(){q&&q.dates.length?(document.querySelector('input[name="dateForm"]').value=q.range,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0}))):alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D \u0434\u0430\u0442!")}),N.addEventListener("click",function(){q=null,d.clear(),H(),J(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(e=>{let n=window.location.origin+window.location.pathname;e.href=n.toString()})}));function R(){document.querySelectorAll(".calendar-wrapper").forEach(e=>{let n=e.querySelector(".calendar"),o=e.getAttribute("data-dates"),l=o?JSON.parse(o):[],m=flatpickr(n,{inline:!0,minDate:"today",dateFormat:"Y-m-d",locale:"ru",defaultDate:l,disable:[function(u){let s=u.toISOString().split("T")[0];return!l.includes(s)&&u<new Date}],onReady:function(){n.querySelectorAll(".flatpickr-day").forEach(s=>{let r=s.getAttribute("aria-label");!l.includes(r)&&s.classList.contains("flatpickr-disabled")&&s.classList.remove("selected")})},onChange:function(){m.setDate(l,!1)}})})}if(R(),document.addEventListener("click",function(e){e.target.id==="cancelBtnFilter"&&(q=null,d.clear(),H(),J(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(o=>{let l=window.location.origin+window.location.pathname;o.href=l.toString()}))}),document.addEventListener("click",function(e){let n=document.querySelectorAll(".dropdown-button"),o=document.querySelectorAll(".dropdown-menu"),l=e.target.closest(".dropdown-button");if(l){let s=Array.from(n).indexOf(l),r=o[s];if(!r)return;let w=r.classList.contains("hidden");o.forEach((h,g)=>{g!==s&&(h.classList.add("hidden"),n[g].setAttribute("aria-expanded","false"))}),w?(r.classList.remove("hidden"),l.setAttribute("aria-expanded","true")):(r.classList.add("hidden"),l.setAttribute("aria-expanded","false"));return}let m=e.target.closest(".dropdown-menu .item");if(m){let s=m.closest(".dropdown-menu"),r=document.querySelector('.dropdown-button[aria-expanded="true"]');s&&r&&(s.classList.add("hidden"),r.setAttribute("aria-expanded","false"));return}let u=e.target.closest(".dropdown-menu .close-menu");if(u){let s=u.closest(".dropdown-menu"),r=document.querySelector('.dropdown-button[aria-expanded="true"]');s&&r&&(s.classList.add("hidden"),r.setAttribute("aria-expanded","false"));return}o.forEach((s,r)=>{!s.contains(e.target)&&!n[r].contains(e.target)&&(s.classList.add("hidden"),n[r].setAttribute("aria-expanded","false"))})}),document.getElementById("category_id")){let n=function(){let o=h=>Array.from(document.querySelectorAll(`#filter-form input[name="${h}"]:checked, #sort_form input[name="${h}"]:checked`)).map(g=>g.value),l=o("duration"),m=o("price"),u=-1,s=o("grade_sort"),r=document.querySelector('input[name="dateForm"]').value??null,w=new URLSearchParams({grade_sort:JSON.stringify(s),price:JSON.stringify(m),duration:JSON.stringify(l),dateForm:r,posts_per_page:u,category_id:e});document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(h=>{let g=new URL(h.href);r&&g.searchParams.set("dateForm",r),m&&g.searchParams.set("price",JSON.stringify(m)),l&&g.searchParams.set("duration",JSON.stringify(l)),h.href=g.toString()}),fetch("/wp-json/my_namespace/v1/filter-posts/?"+w.toString()).then(h=>{if(!h.ok)throw new Error("Failed to fetch the template.");return h.json()}).then(h=>{console.log(h.data),document.getElementById("tours").innerHTML=h.data.html,document.getElementById("card_link").scrollIntoView({block:"start",behavior:"smooth"}),R(),z();let g=document.querySelectorAll(".sidebar-toggle"),E=document.getElementById("sidebar-menu");g.length&&E&&(g.forEach(v=>{v.classList.toggle("is-active")}),E.classList.remove("translate-x-0"),E.classList.add("-translate-x-[1700px]"))}).catch(h=>console.error("Error loading posts:",h))};var re=n;let e=document.getElementById("category_id").value;document.getElementById("filter-form").addEventListener("change",function(){n()}),document.getElementById("sort_form").addEventListener("change",function(){n()})}function H(){let e=document.getElementById("filter-form");Array.from(e.elements).forEach(n=>{switch(n.type){case"text":case"textarea":case"password":case"email":case"url":case"number":case"search":case"tel":case"hidden":n.value="";break;case"checkbox":case"radio":n.checked=!1;break;case"select-one":case"select-multiple":n.selectedIndex=-1;break;default:break}})}function J(){let e=window.location.origin+window.location.pathname;window.history.replaceState({},document.title,e)}function Y(e){return e.trim()?/^(\+7|8)?[\s-]?(\(?\d{3}\)?)?[\s-]?\d{3}[\s-]?\d{2}[\s-]?\d{2}$/.test(e.trim()):!1}let W=document.querySelector(".reviews_form");if(W){let n=function(r,w){Array.from(w.querySelectorAll(".data-item")).forEach(g=>{g.style.display="block"}),w.classList.remove("hidden")},o=function(r,w){let h=r.value.toLowerCase(),g=Array.from(w.querySelectorAll(".data-item"));if(h===""){w.classList.add("hidden");return}let E=!1;g.forEach(v=>{v.textContent.toLowerCase().includes(h)?(v.style.display="block",E=!0):v.style.display="none"}),E?w.classList.remove("hidden"):w.classList.add("hidden")},l=function(){document.querySelectorAll(".reviews_form placeholder ul").forEach(r=>{r.classList.add("hidden")})};var ae=n,ce=o,ie=l;let e=document.getElementById("inputField");document.querySelectorAll(".list-input input[name]").forEach(r=>{let w=r.nextElementSibling;if(!w)return;let h=()=>{w.classList.remove("hidden")},g=()=>{w.classList.add("hidden")};r.addEventListener("focus",h),r.addEventListener("input",()=>{let E=r.value.toLowerCase();w.querySelectorAll(".data-item").forEach(v=>{let A=v.textContent.toLowerCase();v.style.display=A.includes(E)?"block":"none"}),h()}),w.addEventListener("mousedown",E=>{let v=E.target.closest(".data-item");v&&(r.value=v.textContent,document.querySelector('input[name="excurs"]').value=v.getAttribute("data-name"),g())}),document.addEventListener("click",E=>{!r.contains(E.target)&&!w.contains(E.target)&&g()})});let m=document.getElementById("photo-input"),u=document.getElementById("preview-container"),s=[];m.addEventListener("change",r=>{Array.from(r.target.files||[]).forEach(h=>{if(!h.type.startsWith("image/"))return;let g=new FileReader;g.onload=E=>{let v=document.createElement("div");v.classList.add("preview");let A=document.createElement("img");A.src=E.target?.result;let I=document.createElement("button");I.innerText="\xD7",I.onclick=()=>{let S=s.indexOf(h);S>-1&&s.splice(S,1),u.removeChild(v)},v.appendChild(A),v.appendChild(I),u.appendChild(v)},g.readAsDataURL(h),s.push(h)}),m.value=""}),W.addEventListener("submit",function(r){r.preventDefault();let w=this.querySelector(".send-btn"),h=w.querySelector(".btn-text"),g=w.querySelector(".loader"),E=r.target,v=E.querySelector("[name=name]").value,A=new FormData(E);s.forEach((S,M)=>{A.append(`file[${M}]`,S)});let I=document.querySelector(".name_field input");if(v)I.classList.remove("alert"),w.disabled=!0,h.classList.add("hidden"),g.classList.remove("hidden");else return I.classList.add("alert"),window.scrollTo({top:document.querySelector(".reviews_form").offsetTop-50,behavior:"smooth"}),!1;setTimeout(()=>{let S=document.querySelector('.popup[data-popup="popup-success-rev"]');S&&S.classList.remove("hidden"),w.disabled=!1,h.classList.remove("hidden"),g.classList.add("hidden")},2500),fetch("/wp-json/custom/v1/reviews-form",{method:"POST",headers:{},body:A}).then(S=>S.ok?S.json():S.json().then(M=>{throw new Error(M.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(S=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",S)}).catch(S=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",S)}).finally(()=>{E.reset(),s.length=0,u.innerHTML=""})})}document.querySelectorAll(".send-letter").forEach(e=>{e.addEventListener("submit",function(n){n.preventDefault();let o=n.target,l=o.getAttribute("data-api"),m=new FormData(o),u=o.querySelector('input[name="tel"]');if(u){let s=m.get("tel");if(Y(s))Y(s)&&u.classList.remove("border","border-[#FF7A45]");else return u.classList.add("border","border-[#FF7A45]"),!1}l&&fetch(`/wp-json/custom/v1/${l}`,{method:"POST",headers:{},body:m}).then(s=>s.ok?s.json():s.json().then(r=>{throw new Error(r.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(s=>{if(!s.success)throw new Error(s.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B");return o.reset(),K(),document.querySelector(".popup[data-popup='popup-success']").classList.remove("hidden"),!0}).catch(s=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",s),alert(s.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})})}),document.querySelectorAll("[data-open]").forEach(e=>{e.addEventListener("click",function(){let n=e.getAttribute("data-open"),o=document.querySelector(`.popup[data-popup="${n}"]`);o&&o.classList.remove("hidden")})});function se(e){e.classList.remove("hidden")}function K(){document.querySelectorAll(".popup-close").forEach(e=>{let n=e.closest(".popup");n&&n.classList.add("hidden")})}document.querySelectorAll(".popup-close").forEach(e=>{e.addEventListener("click",function(){let n=e.closest(".popup");n&&n.classList.add("hidden")})}),document.querySelectorAll(".popup").forEach(e=>{e.addEventListener("click",function(n){if(n.target===e){e.classList.add("hidden");let o=e.querySelector(".popup-media-container");o&&(o.innerHTML="")}})}),document.querySelectorAll(".togler").forEach(e=>{e.textContent="\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432",e.addEventListener("click",()=>{e.textContent=e.textContent==="\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432"?"\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C \u043E\u0442\u0437\u044B\u0432":"\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432";let n=e.closest(".text_toggle").querySelector(".rev-text");n&&(n.classList.toggle("long-rev"),n.classList.toggle("short-rev"))})});function z(){let e=document.getElementById("response");if(!e)return;let n=e.querySelectorAll(".wish-btn");if(o(n),e.dataset.initialized)return;e.dataset.initialized=!0,e.addEventListener("click",m=>{let u=m.target.closest(".wish-btn");u&&l(u)});function o(m){let u=P("product");try{u=u?JSON.parse(u):[]}catch(s){console.error("Error parsing cookies:",s),u=[]}m.forEach(s=>{let r=s.getAttribute("data-wp-id");u.includes(r)&&s.classList.add("active")})}function l(m){let u=P("product");try{u=u?JSON.parse(u):[]}catch(r){console.error("Error parsing cookies:",r),u=[]}let s=m.getAttribute("data-wp-id");u.includes(s)?(u=u.filter(r=>r!==s),m.classList.remove("active")):(u.push(s),m.classList.add("active")),Q("product",JSON.stringify(u),7),U("product","#product-count span","#product-count div")}}z();function U(e,n,o){let l=P(e);if(l)try{let m=JSON.parse(l);Array.isArray(m)&&(document.querySelector(n).textContent=m.length,m.length<1?document.querySelector(o).style.visibility="hidden":document.querySelector(o).style.visibility="visible")}catch(m){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0435 \u043A\u0443\u043A\u0438 '"+e+"':",m)}else document.querySelector(n).textContent=0}U("product","#product-count span","#product-count div");function P(e){let n=document.cookie.split(";");for(let o=0;o<n.length;o++){let l=n[o].trim();if(l.startsWith(e+"="))return l.substring(e.length+1)}return null}function Q(e,n,o){let l=new Date;l.setTime(l.getTime()+o*24*60*60*1e3);let m="expires="+l.toUTCString();document.cookie=e+"="+n+";"+m+";path=/"}document.body.addEventListener("click",function(e){if(e.target.classList.contains("delete")){let n=Array.from(document.querySelectorAll(".delete")).indexOf(e.target);console.log("\u0423\u0434\u0430\u043B\u044F\u0435\u043C \u0444\u0430\u0439\u043B:",n),filestoupload.splice(n,1),e.target.parentElement.remove(),console.log("Files to upload:",filestoupload.length)}}),window.addEventListener("scroll",function(){if(window.innerWidth>=1024)return;let e=document.getElementById("card_link"),n=document.getElementById("sticky-element");if(!e||!n)return;let o=e.getBoundingClientRect();o.top<=0&&o.bottom>=1e3?(n.classList.add("fixed"),n.classList.remove("hidden")):(n.classList.remove("fixed"),n.classList.add("hidden"))});let F=document.querySelectorAll(".int_mesta .item"),B=document.querySelector(".show-more");F.length&&B&&(F.length>6&&B.classList.remove("hidden"),B.addEventListener("click",function(){F.forEach(e=>e.classList.remove("hidden")),B.classList.add("hidden")}));let k=document.querySelector(".g-scrolling-carousel .overflow-x-auto");if(k){let e=!1,n,o;k.addEventListener("wheel",function(l){l.preventDefault(),k.scrollLeft+=l.deltaY}),k.addEventListener("mousedown",function(l){e=!0,n=l.pageX-k.offsetLeft,o=k.scrollLeft}),k.addEventListener("mouseleave",function(){e=!1}),k.addEventListener("mouseup",function(){e=!1}),k.addEventListener("mousemove",function(l){if(!e)return;l.preventDefault();let u=(l.pageX-k.offsetLeft-n)*3;k.scrollLeft=o-u})}let O=document.getElementById("scrollToTop");window.addEventListener("scroll",function(){window.scrollY>=800?O.classList.remove("hidden","opacity-0"):O.classList.add("hidden","opacity-0")}),O.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})});document.addEventListener("DOMContentLoaded",()=>{async function c(){let i=document.getElementById("order_form-page");if(i&&i.dataset.crm){let a=i.dataset.crm;fetch("/wp-json/custom/v1/tour_tickets?id="+a,{method:"POST",headers:{"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445");return t.json()}).then(t=>{window.dates=t;let p=document.querySelector('#order_form-page [type="date"]');p&&(p.value=window.dates.min_date,p.setAttribute("value",window.dates.min_date),p.setAttribute("min",window.dates.min_date),p.setAttribute("max",window.dates.max_date),p.dispatchEvent(new Event("change"))),document.dispatchEvent(new Event("dates_loaded",{bubbles:!0}))}).catch(t=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",t)})}}c().then(()=>{document.querySelector('#order_form-page [type="date"]')?.addEventListener("change",function(){let i=this.value,a="",t=[],p=[],f=[];if(window.dates&&window.dates.dates){window.dates.dates.forEach(d=>{f.includes(d.date)||(f.push(d.date),p.push(d)),i===d.date&&(d.time===d.a1||!d.a1||d.a1==="undefined")&&(a+=`<button type="button" class="time_btn tickets_addr_item" data-id="${d.id}"  data-crm="${d.tour_id}" data-time="${d.time}" data-ticks="${d.tickets}" data-a="a1"> ${d.time} </button>`)});let L=new Date,x=new Date;x.setDate(L.getDate()+1);let y=new Date;y.setDate(L.getDate()+2);let C=_(L.toISOString().split("T")[0]),D=_(x.toISOString().split("T")[0]),T=_(y.toISOString().split("T")[0]),V=p.some(d=>_(d.date)===C),$=p.some(d=>_(d.date)===D),j=p.some(d=>_(d.date)===T);if(V){let d=p.find(b=>_(b.date)===C);t.push({label:"\u0421\u0435\u0433\u043E\u0434\u043D\u044F",date:_(d.date),dateItem:d.date})}if($){let d=p.find(b=>_(b.date)===D);t.push({label:"\u0417\u0430\u0432\u0442\u0440\u0430",date:_(d.date),dateItem:d.date})}if(j){let d=p.find(b=>_(b.date)===T);t.push({label:"\u041F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430",date:_(d.date),dateItem:d.date})}p.slice(t.length,t.length+3).forEach(d=>{t.length<3&&t.push({label:Z(d.date),date:_(d.date),dateItem:d.date})}),flatpickr("#calendarSelected",{inline:!0,minDate:"today",dateFormat:"Y-m-d",locale:"ru",enable:f,onChange:function(d,b){document.querySelector('#order_form-page [type="date"]').value=b,document.querySelector('#order_form-page [type="date"]').setAttribute("value",b),document.querySelector('#order_form-page [type="date"]').dispatchEvent(new Event("change"))}});let q=document.getElementById("dateButtonsContainer");q.innerHTML="",t.forEach(d=>{let b=document.createElement("button");b.type="button",b.setAttribute("data-value",d.dateItem),i===d.dateItem?b.className="date_btn active":b.className="date_btn",b.innerHTML=`
						<span class="self-stretch justify-center items-center inline-flex pointer-events-none">
							<span class="text-lg font-normal leading-normal">${d.label}</span>
						</span>
						<span class="self-stretch justify-center items-center inline-flex pointer-events-none">
							<span class="text-lg font-bold leading-normal">${d.date}</span>
						</span>
					`,b.addEventListener("click",()=>{this.value=d.dateItem,this.setAttribute("value",d.dateItem),this.dispatchEvent(new Event("change")),console.log("\u0412\u044B\u0431\u0440\u0430\u043D\u0430 \u0434\u0430\u0442\u0430:",d.date)}),q.appendChild(b)}),p.length>t.length?document.getElementById("show_calendar").classList.remove("hidden"):document.getElementById("show_calendar").classList.add("hidden")}document.querySelector(".tickets_addr_items").innerHTML=a,document.querySelector(".tickets_addr_items > *:first-child")?.click(),a||(document.querySelector(".tickets_addr_note").textContent="\u041D\u0435\u0442 \u0431\u0438\u043B\u0435\u0442\u043E\u0432")})})});document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",c=>{c.target.classList.contains("date_btn")&&document.querySelectorAll(".date_btn").forEach(a=>{console.log(a),document.querySelector('#order_form-page [type="date"]').value!==a.getAttribute("data-value")?a.classList.remove("active"):a.classList.add("active")})})});var G=c=>["\u044F\u043D\u0432\u0430\u0440\u044F","\u0444\u0435\u0432\u0440\u0430\u043B\u044F","\u043C\u0430\u0440\u0442\u0430","\u0430\u043F\u0440\u0435\u043B\u044F","\u043C\u0430\u044F","\u0438\u044E\u043D\u044F","\u0438\u044E\u043B\u044F","\u0430\u0432\u0433\u0443\u0441\u0442\u0430","\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F","\u043E\u043A\u0442\u044F\u0431\u0440\u044F","\u043D\u043E\u044F\u0431\u0440\u044F","\u0434\u0435\u043A\u0430\u0431\u0440\u044F"][c-1]||"",Z=c=>{let i=["\u0412\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435","\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A","\u0412\u0442\u043E\u0440\u043D\u0438\u043A","\u0421\u0440\u0435\u0434\u0430","\u0427\u0435\u0442\u0432\u0435\u0440\u0433","\u041F\u044F\u0442\u043D\u0438\u0446\u0430","\u0421\u0443\u0431\u0431\u043E\u0442\u0430"],a=new Date(c);return i[a.getDay()]},_=c=>{let[i,a,t]=c.split("-");return`${parseInt(t)} ${G(parseInt(a))}`},ee=c=>{let[i,a,t]=c.split("-");return`${parseInt(t)} ${G(parseInt(a))} ${i}`};document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",c=>{let i=c.target;if(!i.classList.contains("tickets_addr_item"))return;document.querySelectorAll(".tickets_addr_item").forEach(y=>y.classList.remove("active")),i.classList.add("active");let a=i.dataset.ticks,t=i.dataset.a,p=i.dataset.crm,f=i.dataset.time,L=i.dataset.id;document.getElementById(t)?.click(),document.querySelector('[name="trip"]').value=L;let x=document.querySelector('[name="id_crm"]');x.value!==p&&(x.value=p,document.getElementById("order_form-page").dataset.crm=p,document.getElementById("all-prices").classList.add("loading"),fetch("/wp-json/custom/v1/get_current_prices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:p})}).then(y=>y.json()).then(y=>{te(y),console.log(y),document.getElementById("all-prices").classList.remove("loading")}).catch(y=>console.error("Error:",y))),document.querySelectorAll(".tickets_addr__note").forEach(y=>y.remove()),document.getElementById("date_and_time").value=document.querySelector("#order_form-page [type=date]").value+" "+f,document.querySelectorAll(".selected_info").forEach(function(y){y.innerHTML=_(document.querySelector("#order_form-page [type=date]").value)+", "+f}),document.querySelectorAll(".selected_info_full").forEach(function(y){y.innerHTML=ee(document.querySelector("#order_form-page [type=date]").value)+", "+f})})});function te(c){[{key:"adult",selector:".form__p_vzroslie",inputName:"price_adults"},{key:"adult_i",selector:".form__p_vzroslie_inostrancy",inputName:"price_adults_for"},{key:"kid",selector:".form__p_doshkolniki",inputName:"price_childs"},{key:"old",selector:".form__p_pensionery",inputName:"price_old"},{key:"school",selector:".form__p_shkolniki",inputName:"price_school"},{key:"student",selector:".form__p_studenty",inputName:"price_students"}].forEach(({key:a,selector:t,inputName:p})=>{let f=document.querySelector(t),L=document.querySelector(`[name="${p}"]`);c[a]&&(f.textContent=c[a][1]||c[a][0],f.parentElement.nextElementSibling.textContent=c[a][1]?`${c[a][0]} \u0440\u0443\u0431.`:"",L.value=c[a][1]||c[a][0])})}document.addEventListener("DOMContentLoaded",function(){let c=document.querySelectorAll(".search-form");c.forEach(i=>{let a=i.querySelector("input"),t=document.createElement("ul");t.className="search-results no-scrollbar",t.style.listStyle="none",t.style.padding="10px 15px",t.style.border="1px solid #ccc",t.style.maxWidth="100%",t.style.display="none",t.style.position="absolute",t.style.backgroundColor="white",t.style.zIndex="1000",t.style.top="35px",t.style.width="285px",t.style.left="0",t.style.minWidth="300px",t.style.maxHeight="400px",t.style.borderRadius="12px",t.style.overflowY="auto",i.appendChild(t),a.addEventListener("input",function(){let p=a.value.trim();if(p.length<2){t.style.display="none";return}fetch(`/wp-json/custom/v1/search-excursions?search=${encodeURIComponent(p)}`).then(f=>f.json()).then(f=>{if(t.innerHTML="",f.length===0){t.style.display="none";return}f.forEach(L=>{let x=document.createElement("li");x.style.padding="5px",x.style.cursor="pointer";let y=document.createElement("a");y.href=L.link,y.innerHTML=L.title,x.appendChild(y),t.appendChild(x)}),t.style.display="block"}).catch(f=>console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u0438\u0441\u043A\u0435:",f))})}),document.addEventListener("click",function(i){c.forEach(a=>{let t=a.querySelector(".search-results");t&&!a.contains(i.target)&&!t.contains(i.target)&&(t.style.display="none")})})});function X(){let c=0,i=0;document.querySelectorAll(".quantity-input").forEach(t=>{let p=t.parentElement.parentElement.previousElementSibling.querySelector(".price").textContent,f=t.parentElement.nextElementSibling.querySelector(".price"),L=parseInt(p,10),x=Number(t.value),y=x*L;f.textContent=y,console.log(f,y),i+=x,c+=y}),document.querySelector("[name=promo]").dispatchEvent(new Event("keyup")),document.querySelector("[name=true_price]").value=c,document.querySelector("[name=amount]").value=i,document.querySelector(".t_price").textContent=c;let a=ne(i,["\u0431\u0438\u043B\u0435\u0442","\u0431\u0438\u043B\u0435\u0442\u0430","\u0431\u0438\u043B\u0435\u0442\u043E\u0432"]);document.querySelector(".tickets").textContent=i+" "+a}function ne(c,i){return i[c%100>4&&c%100<20?2:[2,0,1,1,1,2][c%10<5?Math.abs(c)%10:5]]}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",c=>{if(c.target.closest(".increase-btn")){let i=c.target.closest("label");if(i){let a=i.querySelector(".quantity-input");if(a){let t=parseInt(a.value,10);t+=1,a.value=t}}X()}if(c.target.closest(".decrease-btn")){let i=c.target.closest("label");if(i){let a=i.querySelector(".quantity-input");if(a){let t=parseInt(a.value,10);t>0&&(t-=1,a.value=t)}}X()}if(c.target.id==="submit_buy"){let i=document.getElementById("order_form-page"),a=new FormData(i);fetch("/wp-json/custom/v1/add_ticket",{method:"POST",headers:{},body:a}).then(t=>t.ok?t.json():t.json().then(p=>{throw new Error(p.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(t=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",t)}).catch(t=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",t),alert(t.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})}})});document.addEventListener("DOMContentLoaded",function(){let c=document.getElementById("cookie-banner"),i=document.getElementById("accept-cookies");localStorage.getItem("cookiesAccepted")||c.classList.remove("hidden"),i.addEventListener("click",function(){localStorage.setItem("cookiesAccepted","true"),c.classList.add("hidden")})});})();
