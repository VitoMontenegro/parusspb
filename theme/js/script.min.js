(()=>{document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("input, textarea").forEach(t=>{t.addEventListener("focus",function(){this.dataset.placeholder=this.placeholder,this.placeholder=""}),t.addEventListener("blur",function(){this.placeholder=this.dataset.placeholder||""})});let n=document.getElementById("sidebar-menu"),s=window.scrollY;n&&window.addEventListener("scroll",()=>{window.scrollY>s?(n.classList.remove("lg:top-[40px]"),n.classList.add("lg:top-[-400px]")):(n.classList.remove("lg:top-[-400px]"),n.classList.add("lg:top-[40px]")),s=window.scrollY});let o=document.getElementById("menu-toggle"),e=document.getElementById("mobile-menu");o&&e&&(o.addEventListener("click",t=>{t.stopPropagation(),o.classList.contains("is-active")?(e.classList.remove("-translate-x-[1700px]"),e.classList.add("translate-x-0"),document.body.style.overflow="hidden"):(e.classList.remove("translate-x-0"),e.classList.add("-translate-x-[1700px]"),document.body.style.overflow=""),o.classList.toggle("is-active")}),document.addEventListener("click",t=>{!e.contains(t.target)&&!o.contains(t.target)&&(e.classList.remove("translate-x-0"),e.classList.add("-translate-x-[1700px]"),o.classList.add("is-active"),document.body.style.overflow="")}));let p=document.querySelectorAll(".sidebar-toggle"),d=document.getElementById("sidebar-menu");p.length&&d&&p.forEach(t=>{t.addEventListener("click",r=>{r.stopPropagation(),t.classList.contains("is-active")?(d.classList.remove("-translate-x-[1700px]"),d.classList.add("translate-x-0")):(d.classList.remove("translate-x-0"),d.classList.add("-translate-x-[1700px]")),t.classList.toggle("is-active")}),document.querySelectorAll(".close-filter-btn").forEach(r=>{r.addEventListener("click",()=>{t.classList.toggle("is-active"),d.classList.remove("translate-x-0"),d.classList.add("-translate-x-[1700px]")})}),document.addEventListener("click",r=>{!d.contains(r.target)&&!t.contains(r.target)&&(d.classList.remove("translate-x-0"),d.classList.add("-translate-x-[1700px]"),t.classList.add("is-active"))})});let f=new Swiper(".swiper_rev",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".rev-button-next",prevEl:".rev-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});f.on("init",()=>{document.querySelector(".rev-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".rev-button-next").classList.remove("swiper-button-disabled")}),f.init();let g=new Swiper(".swiper_similar",{slidesPerView:1,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".similar-button-next",prevEl:".similar-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});f.on("init",()=>{document.querySelector(".similar-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".similar-button-next").classList.remove("swiper-button-disabled")}),f.init();let y=new Swiper(".swiper_gids",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".gid-button-next",prevEl:".gid-button-prev"},breakpoints:{490:{slidesPerView:3.5,spaceBetween:32}}});y.on("init",()=>{document.querySelector(".gid-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".gid-button-next").classList.remove("swiper-button-disabled")}),y.init();let A=new Swiper(".swiper_custom",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}}),I=new Swiper(".swiper_four",{slidesPerView:1.2,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:24},1100:{slidesPerView:4,spaceBetween:24}}}),E=new Swiper(".swiper_five",{slidesPerView:1.2,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:24},1100:{slidesPerView:5,spaceBetween:24}}});if(document.querySelectorAll(".swiper_tour").length){let t=new Swiper(".mySwiper2",{spaceBetween:8,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}});document.querySelectorAll(".fancy-video img").forEach(a=>{let l=a.getAttribute("src"),h=a.getAttribute("alt"),m=a.getAttribute("data-video-id"),c=a.getAttribute("data-video-type");if(!m)a.setAttribute("data-src",l),a.setAttribute("data-caption",h);else{let i="";c==="youtube"?i=`https://www.youtube.com/embed/${m}?autoplay=1`:c==="rutube"?i=`https://rutube.ru/play/embed/${m}?autoplay=1`:c==="dzen"&&(i=m),a.setAttribute("data-fancybox","gallery"),a.setAttribute("data-src",i),a.setAttribute("data-caption",h)}}),Fancybox.bind('[data-fancybox="gallery"]',{infinite:!0,groupAll:!0,caption:function(a,l,h){return h.alt}})}if(document.querySelectorAll(".swiper_block")){let t=new Swiper(".swiperBlock",{slidesPerView:2.2,spaceBetween:11,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{490:{slidesPerView:2.2,spaceBetween:11},790:{slidesPerView:3,spaceBetween:24},1023:{slidesPerView:5,spaceBetween:24}}})}if(document.querySelectorAll(".swiper_small")){let t=new Swiper(".swiper_small",{slidesPerView:1.5,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".rev-button-next",prevEl:".rev-button-prev"},breakpoints:{490:{slidesPerView:4,spaceBetween:24}}})}let B=null,u=flatpickr("#calendar",{inline:!0,mode:"range",minDate:"today",dateFormat:"Y-m-d",locale:"ru",onChange:function(t,r,a){B={dates:t,range:r},document.querySelectorAll(".flatpickr-day.confirmed-range").forEach(l=>{l.classList.remove("confirmed-range")}),t.length===2&&setTimeout(()=>{document.querySelectorAll(".flatpickr-day.inRange").forEach(l=>{l.classList.add("confirmed-range")})},10)}}),S=document.getElementById("okBtn"),R=document.getElementById("cancelBtn");S&&R&&(S.addEventListener("click",function(){B&&B.dates.length?(document.querySelector('input[name="dateForm"]').value=B.range,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0}))):alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D \u0434\u0430\u0442!")}),R.addEventListener("click",function(){B=null,u.clear(),J(),Y(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(t=>{let r=window.location.origin+window.location.pathname;t.href=r.toString()})}));function H(){document.querySelectorAll(".calendar-wrapper").forEach(t=>{let r=t.querySelector(".calendar"),a=t.getAttribute("data-dates"),l=a?JSON.parse(a):[],h=flatpickr(r,{inline:!0,minDate:"today",dateFormat:"Y-m-d",locale:"ru",defaultDate:l,disable:[function(m){let c=m.toISOString().split("T")[0];return!l.includes(c)&&m<new Date}],onReady:function(){r.querySelectorAll(".flatpickr-day").forEach(c=>{let i=c.getAttribute("aria-label");!l.includes(i)&&c.classList.contains("flatpickr-disabled")&&c.classList.remove("selected")})},onChange:function(){h.setDate(l,!1)}})})}if(H(),document.addEventListener("click",function(t){t.target.id==="cancelBtnFilter"&&(B=null,u.clear(),J(),Y(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(a=>{let l=window.location.origin+window.location.pathname;a.href=l.toString()}))}),document.addEventListener("click",function(t){let r=document.querySelectorAll(".dropdown-button"),a=document.querySelectorAll(".dropdown-menu"),l=t.target.closest(".dropdown-button");if(l){let c=Array.from(r).indexOf(l),i=a[c];if(!i)return;let b=i.classList.contains("hidden");a.forEach((v,w)=>{w!==c&&(v.classList.add("hidden"),r[w].setAttribute("aria-expanded","false"))}),b?(i.classList.remove("hidden"),l.setAttribute("aria-expanded","true")):(i.classList.add("hidden"),l.setAttribute("aria-expanded","false"));return}let h=t.target.closest(".dropdown-menu .item");if(h){let c=h.closest(".dropdown-menu"),i=document.querySelector('.dropdown-button[aria-expanded="true"]');c&&i&&(c.classList.add("hidden"),i.setAttribute("aria-expanded","false"));return}let m=t.target.closest(".dropdown-menu .close-menu");if(m){let c=m.closest(".dropdown-menu"),i=document.querySelector('.dropdown-button[aria-expanded="true"]');c&&i&&(c.classList.add("hidden"),i.setAttribute("aria-expanded","false"));return}a.forEach((c,i)=>{!c.contains(t.target)&&!r[i].contains(t.target)&&(c.classList.add("hidden"),r[i].setAttribute("aria-expanded","false"))})}),document.getElementById("category_id")){let r=function(){let a=v=>Array.from(document.querySelectorAll(`#filter-form input[name="${v}"]:checked, #sort_form input[name="${v}"]:checked`)).map(w=>w.value),l=a("duration"),h=a("price"),m=-1,c=a("grade_sort"),i=document.querySelector('input[name="dateForm"]').value??null,b=new URLSearchParams({grade_sort:JSON.stringify(c),price:JSON.stringify(h),duration:JSON.stringify(l),dateForm:i,posts_per_page:m,category_id:t});document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(v=>{let w=new URL(v.href);i&&w.searchParams.set("dateForm",i),h&&w.searchParams.set("price",JSON.stringify(h)),l&&w.searchParams.set("duration",JSON.stringify(l)),v.href=w.toString()}),fetch("/wp-json/my_namespace/v1/filter-posts/?"+b.toString()).then(v=>{if(!v.ok)throw new Error("Failed to fetch the template.");return v.json()}).then(v=>{document.getElementById("tours").innerHTML=v.data.html,document.getElementById("card_link").scrollIntoView({block:"start",behavior:"smooth"}),H(),U();let w=document.querySelectorAll(".sidebar-toggle"),_=document.getElementById("sidebar-menu");w.length&&_&&(w.forEach(L=>{L.classList.toggle("is-active")}),_.classList.remove("translate-x-0"),_.classList.add("-translate-x-[1700px]"))}).catch(v=>console.error("Error loading posts:",v))};var ce=r;let t=document.getElementById("category_id").value;document.getElementById("filter-form").addEventListener("change",function(){r()}),document.getElementById("sort_form").addEventListener("change",function(){r()})}function J(){let t=document.getElementById("filter-form");Array.from(t.elements).forEach(r=>{switch(r.type){case"text":case"textarea":case"password":case"email":case"url":case"number":case"search":case"tel":case"hidden":r.value="";break;case"checkbox":case"radio":r.checked=!1;break;case"select-one":case"select-multiple":r.selectedIndex=-1;break;default:break}})}function Y(){let t=window.location.origin+window.location.pathname;window.history.replaceState({},document.title,t)}function W(t){return t.trim()?/^(\+7|8)?[\s-]?(\(?\d{3}\)?)?[\s-]?\d{3}[\s-]?\d{2}[\s-]?\d{2}$/.test(t.trim()):!1}let z=document.querySelector(".reviews_form");if(z){let r=function(i,b){Array.from(b.querySelectorAll(".data-item")).forEach(w=>{w.style.display="block"}),b.classList.remove("hidden")},a=function(i,b){let v=i.value.toLowerCase(),w=Array.from(b.querySelectorAll(".data-item"));if(v===""){b.classList.add("hidden");return}let _=!1;w.forEach(L=>{L.textContent.toLowerCase().includes(v)?(L.style.display="block",_=!0):L.style.display="none"}),_?b.classList.remove("hidden"):b.classList.add("hidden")},l=function(){document.querySelectorAll(".reviews_form placeholder ul").forEach(i=>{i.classList.add("hidden")})};var ie=r,le=a,de=l;let t=document.getElementById("inputField");document.querySelectorAll(".list-input input[name]").forEach(i=>{let b=i.nextElementSibling;if(!b)return;let v=()=>{b.classList.remove("hidden")},w=()=>{b.classList.add("hidden")};i.addEventListener("focus",v),i.addEventListener("input",()=>{let _=i.value.toLowerCase();b.querySelectorAll(".data-item").forEach(L=>{let C=L.textContent.toLowerCase();L.style.display=C.includes(_)?"block":"none"}),v()}),b.addEventListener("mousedown",_=>{let L=_.target.closest(".data-item");L&&(i.value=L.textContent,document.querySelector('input[name="excurs"]').value=L.getAttribute("data-name"),w())}),document.addEventListener("click",_=>{!i.contains(_.target)&&!b.contains(_.target)&&w()})});let h=document.getElementById("photo-input"),m=document.getElementById("preview-container"),c=[];h.addEventListener("change",i=>{Array.from(i.target.files||[]).forEach(v=>{if(!v.type.startsWith("image/"))return;let w=new FileReader;w.onload=_=>{let L=document.createElement("div");L.classList.add("preview");let C=document.createElement("img");C.src=_.target?.result;let D=document.createElement("button");D.innerText="\xD7",D.onclick=()=>{let q=c.indexOf(v);q>-1&&c.splice(q,1),m.removeChild(L)},L.appendChild(C),L.appendChild(D),m.appendChild(L)},w.readAsDataURL(v),c.push(v)}),h.value=""}),z.addEventListener("submit",function(i){i.preventDefault();let b=this.querySelector(".send-btn"),v=b.querySelector(".btn-text"),w=b.querySelector(".loader"),_=i.target,L=_.querySelector("[name=name]").value,C=new FormData(_);c.forEach((q,M)=>{C.append(`file[${M}]`,q)});let D=document.querySelector(".name_field input");if(L)D.classList.remove("alert"),b.disabled=!0,v.classList.add("hidden"),w.classList.remove("hidden");else return D.classList.add("alert"),window.scrollTo({top:document.querySelector(".reviews_form").offsetTop-50,behavior:"smooth"}),!1;setTimeout(()=>{let q=document.querySelector('.popup[data-popup="popup-success-rev"]');q&&q.classList.remove("hidden"),b.disabled=!1,v.classList.remove("hidden"),w.classList.add("hidden")},2500),fetch("/wp-json/custom/v1/reviews-form",{method:"POST",headers:{},body:C}).then(q=>q.ok?q.json():q.json().then(M=>{throw new Error(M.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(q=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",q)}).catch(q=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",q)}).finally(()=>{_.reset(),c.length=0,m.innerHTML=""})})}document.querySelectorAll(".send-letter").forEach(t=>{t.addEventListener("submit",function(r){r.preventDefault();let a=r.target,l=a.getAttribute("data-api"),h=new FormData(a),m=a.querySelector('input[name="tel"]');if(m){let c=h.get("tel");if(W(c))W(c)&&m.classList.remove("border","border-[#FF7A45]");else return m.classList.add("border","border-[#FF7A45]"),!1}l&&fetch(`/wp-json/custom/v1/${l}`,{method:"POST",headers:{},body:h}).then(c=>c.ok?c.json():c.json().then(i=>{throw new Error(i.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(c=>{if(!c.success)throw new Error(c.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B");return a.reset(),Z(),document.querySelector(".popup[data-popup='popup-success']").classList.remove("hidden"),!0}).catch(c=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",c),alert(c.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})})}),document.querySelectorAll("[data-open]").forEach(t=>{t.addEventListener("click",function(){let r=t.getAttribute("data-open"),a=document.querySelector(`.popup[data-popup="${r}"]`);a&&a.classList.remove("hidden")})});function ae(t){t.classList.remove("hidden")}function Z(){document.querySelectorAll(".popup-close").forEach(t=>{let r=t.closest(".popup");r&&r.classList.add("hidden")})}document.querySelectorAll(".popup-close").forEach(t=>{t.addEventListener("click",function(){let r=t.closest(".popup");r&&r.classList.add("hidden")})}),document.querySelectorAll(".popup").forEach(t=>{t.addEventListener("click",function(r){if(r.target===t){t.classList.add("hidden");let a=t.querySelector(".popup-media-container");a&&(a.innerHTML="")}})}),document.querySelectorAll(".togler").forEach(t=>{t.textContent="\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432",t.addEventListener("click",()=>{t.textContent=t.textContent==="\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432"?"\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C \u043E\u0442\u0437\u044B\u0432":"\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432";let r=t.closest(".text_toggle").querySelector(".rev-text");r&&(r.classList.toggle("long-rev"),r.classList.toggle("short-rev"))})});function U(){let t=document.getElementById("response");if(!t)return;let r=t.querySelectorAll(".wish-btn");if(a(r),t.dataset.initialized)return;t.dataset.initialized=!0,t.addEventListener("click",h=>{let m=h.target.closest(".wish-btn");m&&l(m)});function a(h){let m=T("product");try{m=m?JSON.parse(m):[]}catch(c){console.error("Error parsing cookies:",c),m=[]}h.forEach(c=>{let i=c.getAttribute("data-wp-id");m.includes(i)&&c.classList.add("active")})}function l(h){let m=T("product");try{m=m?JSON.parse(m):[]}catch(i){console.error("Error parsing cookies:",i),m=[]}let c=h.getAttribute("data-wp-id");m.includes(c)?(m=m.filter(i=>i!==c),h.classList.remove("active")):(m.push(c),h.classList.add("active")),ee("product",JSON.stringify(m),7),X("product","#product-count span","#product-count div")}}U();function X(t,r,a){let l=T(t);if(l)try{let h=JSON.parse(l);Array.isArray(h)&&(document.querySelector(r).textContent=h.length,h.length<1?document.querySelector(a).style.visibility="hidden":document.querySelector(a).style.visibility="visible")}catch(h){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0435 \u043A\u0443\u043A\u0438 '"+t+"':",h)}else document.querySelector(r).textContent=0}X("product","#product-count span","#product-count div");function T(t){let r=document.cookie.split(";");for(let a=0;a<r.length;a++){let l=r[a].trim();if(l.startsWith(t+"="))return l.substring(t.length+1)}return null}function ee(t,r,a){let l=new Date;l.setTime(l.getTime()+a*24*60*60*1e3);let h="expires="+l.toUTCString();document.cookie=t+"="+r+";"+h+";path=/"}document.body.addEventListener("click",function(t){if(t.target.classList.contains("delete")){let r=Array.from(document.querySelectorAll(".delete")).indexOf(t.target);console.log("\u0423\u0434\u0430\u043B\u044F\u0435\u043C \u0444\u0430\u0439\u043B:",r),filestoupload.splice(r,1),t.target.parentElement.remove(),console.log("Files to upload:",filestoupload.length)}}),window.addEventListener("scroll",function(){if(window.innerWidth>=1024)return;let t=document.getElementById("card_link"),r=document.getElementById("sticky-element");if(!t||!r)return;let a=t.getBoundingClientRect();a.top<=0&&a.bottom>=1e3?(r.classList.add("fixed"),r.classList.remove("hidden")):(r.classList.remove("fixed"),r.classList.add("hidden"))});let F=document.querySelectorAll(".int_mesta .item"),P=document.querySelector(".show-more");F.length&&P&&(F.length>6&&P.classList.remove("hidden"),P.addEventListener("click",function(){F.forEach(t=>t.classList.remove("hidden")),P.classList.add("hidden")}));let k=document.querySelector(".g-scrolling-carousel .overflow-x-auto");if(k){let t=!1,r,a;k.addEventListener("wheel",function(l){l.preventDefault(),k.scrollLeft+=l.deltaY}),k.addEventListener("mousedown",function(l){t=!0,r=l.pageX-k.offsetLeft,a=k.scrollLeft}),k.addEventListener("mouseleave",function(){t=!1}),k.addEventListener("mouseup",function(){t=!1}),k.addEventListener("mousemove",function(l){if(!t)return;l.preventDefault();let m=(l.pageX-k.offsetLeft-r)*3;k.scrollLeft=a-m})}let O=document.getElementById("scrollToTop");window.addEventListener("scroll",function(){window.scrollY>=800?O.classList.remove("hidden","opacity-0"):O.classList.add("hidden","opacity-0")}),O.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})});document.addEventListener("DOMContentLoaded",()=>{async function n(){let s=document.getElementById("order_form-page");if(s&&s.dataset.crm){let o=s.dataset.crm;fetch("/wp-json/custom/v1/tour_tickets?id="+o,{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>{if(!e.ok)throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445");return e.json()}).then(e=>{window.dates=e;let p=document.querySelector('#order_form-page [type="date"]');p&&(p.value=window.dates.min_date,p.setAttribute("value",window.dates.min_date),p.setAttribute("min",window.dates.min_date),p.setAttribute("max",window.dates.max_date),p.dispatchEvent(new Event("change"))),document.dispatchEvent(new Event("dates_loaded",{bubbles:!0}))}).catch(e=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",e)})}}n().then(()=>{document.querySelector('#order_form-page [type="date"]')?.addEventListener("change",function(){let s=this.value,o="",e=[],p=[],d=[];if(window.dates&&window.dates.dates){window.dates.dates.forEach(u=>{d.includes(u.date)||(d.push(u.date),p.push(u)),s===u.date&&(u.time===u.a1||!u.a1||u.a1==="undefined")&&(o+=`<button type="button" class="time_btn tickets_addr_item" data-id="${u.id}"  data-crm="${u.tour_id}" data-time="${u.time}" data-ticks="${u.tickets}" data-a="a1"> ${u.time} </button>`)});let f=new Date,g=new Date;g.setDate(f.getDate()+1);let y=new Date;y.setDate(f.getDate()+2);let A=x(f.toISOString().split("T")[0]),I=x(g.toISOString().split("T")[0]),E=x(y.toISOString().split("T")[0]),V=p.some(u=>x(u.date)===A),j=p.some(u=>x(u.date)===I),N=p.some(u=>x(u.date)===E);if(V){let u=p.find(S=>x(S.date)===A);e.push({label:"\u0421\u0435\u0433\u043E\u0434\u043D\u044F",date:x(u.date),dateItem:u.date})}if(j){let u=p.find(S=>x(S.date)===I);e.push({label:"\u0417\u0430\u0432\u0442\u0440\u0430",date:x(u.date),dateItem:u.date})}if(N){let u=p.find(S=>x(S.date)===E);e.push({label:"\u041F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430",date:x(u.date),dateItem:u.date})}p.slice(e.length,e.length+3).forEach(u=>{e.length<3&&e.push({label:te(u.date),date:x(u.date),dateItem:u.date})}),flatpickr("#calendarSelected",{inline:!0,minDate:"today",dateFormat:"Y-m-d",locale:"ru",enable:d,onChange:function(u,S){document.querySelector('#order_form-page [type="date"]').value=S,document.querySelector('#order_form-page [type="date"]').setAttribute("value",S),document.querySelector('#order_form-page [type="date"]').dispatchEvent(new Event("change"))}});let B=document.getElementById("dateButtonsContainer");B.innerHTML="",e.forEach(u=>{let S=document.createElement("button");S.type="button",S.setAttribute("data-value",u.dateItem),s===u.dateItem?S.className="date_btn active":S.className="date_btn",S.innerHTML=`
						<span class="self-stretch justify-center items-center inline-flex pointer-events-none">
							<span class="text-lg font-normal leading-normal">${u.label}</span>
						</span>
						<span class="self-stretch justify-center items-center inline-flex pointer-events-none">
							<span class="text-lg font-bold leading-normal">${u.date}</span>
						</span>
					`,S.addEventListener("click",()=>{this.value=u.dateItem,this.setAttribute("value",u.dateItem),this.dispatchEvent(new Event("change")),console.log("\u0412\u044B\u0431\u0440\u0430\u043D\u0430 \u0434\u0430\u0442\u0430:",u.date)}),B.appendChild(S)}),p.length>e.length?document.getElementById("show_calendar").classList.remove("hidden"):document.getElementById("show_calendar").classList.add("hidden")}document.querySelector(".tickets_addr_items").innerHTML=o,document.querySelector(".tickets_addr_items > *:first-child")?.click(),o||(document.querySelector(".tickets_addr_note").textContent="\u041D\u0435\u0442 \u0431\u0438\u043B\u0435\u0442\u043E\u0432")})})});document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",n=>{n.target.classList.contains("date_btn")&&document.querySelectorAll(".date_btn").forEach(o=>{console.log(o),document.querySelector('#order_form-page [type="date"]').value!==o.getAttribute("data-value")?o.classList.remove("active"):o.classList.add("active")})})});var Q=n=>["\u044F\u043D\u0432\u0430\u0440\u044F","\u0444\u0435\u0432\u0440\u0430\u043B\u044F","\u043C\u0430\u0440\u0442\u0430","\u0430\u043F\u0440\u0435\u043B\u044F","\u043C\u0430\u044F","\u0438\u044E\u043D\u044F","\u0438\u044E\u043B\u044F","\u0430\u0432\u0433\u0443\u0441\u0442\u0430","\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F","\u043E\u043A\u0442\u044F\u0431\u0440\u044F","\u043D\u043E\u044F\u0431\u0440\u044F","\u0434\u0435\u043A\u0430\u0431\u0440\u044F"][n-1]||"",te=n=>{let s=["\u0412\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435","\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A","\u0412\u0442\u043E\u0440\u043D\u0438\u043A","\u0421\u0440\u0435\u0434\u0430","\u0427\u0435\u0442\u0432\u0435\u0440\u0433","\u041F\u044F\u0442\u043D\u0438\u0446\u0430","\u0421\u0443\u0431\u0431\u043E\u0442\u0430"],o=new Date(n);return s[o.getDay()]},x=n=>{let[s,o,e]=n.split("-");return`${parseInt(e)} ${Q(parseInt(o))}`},ne=n=>{let[s,o,e]=n.split("-");return`${parseInt(e)} ${Q(parseInt(o))} ${s}`};document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",n=>{let s=n.target;if(!s.classList.contains("tickets_addr_item"))return;document.querySelectorAll(".tickets_addr_item").forEach(y=>y.classList.remove("active")),s.classList.add("active");let o=s.dataset.ticks,e=s.dataset.a,p=s.dataset.crm,d=s.dataset.time,f=s.dataset.id;document.getElementById(e)?.click(),document.querySelector('[name="trip"]').value=f;let g=document.querySelector('[name="id_crm"]');g.value!==p&&(g.value=p,document.getElementById("order_form-page").dataset.crm=p,document.getElementById("all-prices").classList.add("loading"),fetch("/wp-json/custom/v1/get_current_prices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:p})}).then(y=>y.json()).then(y=>{oe(y),document.getElementById("all-prices").classList.remove("loading")}).catch(y=>console.error("Error:",y))),document.querySelectorAll(".tickets_addr__note").forEach(y=>y.remove()),document.getElementById("date_and_time").value=document.querySelector("#order_form-page [type=date]").value+" "+d,document.querySelectorAll(".selected_info").forEach(function(y){y.innerHTML=x(document.querySelector("#order_form-page [type=date]").value)+", "+d}),document.querySelectorAll(".selected_info_full").forEach(function(y){y.innerHTML=ne(document.querySelector("#order_form-page [type=date]").value)+", "+d})})});function oe(n){[{key:"adult",selector:".form__p_vzroslie",inputName:"price_adults"},{key:"adult_i",selector:".form__p_vzroslie_inostrancy",inputName:"price_adults_for"},{key:"kid",selector:".form__p_doshkolniki",inputName:"price_childs"},{key:"old",selector:".form__p_pensionery",inputName:"price_old"},{key:"school",selector:".form__p_shkolniki",inputName:"price_school"},{key:"student",selector:".form__p_studenty",inputName:"price_students"}].forEach(({key:o,selector:e,inputName:p})=>{let d=document.querySelector(e),f=document.querySelector(`[name="${p}"]`);n[o]&&(d.textContent=n[o][1]||n[o][0],d.parentElement.nextElementSibling.textContent=n[o][1]?`${n[o][0]} \u0440\u0443\u0431.`:"",f.value=n[o][1]||n[o][0])})}document.addEventListener("DOMContentLoaded",function(){let n=document.querySelectorAll(".search-form");n.forEach(s=>{let o=s.querySelector("input"),e=document.createElement("ul");e.className="search-results no-scrollbar",e.style.listStyle="none",e.style.padding="10px 15px",e.style.border="1px solid #ccc",e.style.maxWidth="100%",e.style.display="none",e.style.position="absolute",e.style.backgroundColor="white",e.style.zIndex="1000",e.style.top="35px",e.style.width="285px",e.style.left="0",e.style.minWidth="300px",e.style.maxHeight="400px",e.style.borderRadius="12px",e.style.overflowY="auto",s.appendChild(e),o.addEventListener("input",function(){let p=o.value.trim();if(p.length<2){e.style.display="none";return}fetch(`/wp-json/custom/v1/search-excursions?search=${encodeURIComponent(p)}`).then(d=>d.json()).then(d=>{if(e.innerHTML="",d.length===0){e.style.display="none";return}d.forEach(f=>{let g=document.createElement("li");g.style.padding="5px",g.style.cursor="pointer";let y=document.createElement("a");y.href=f.link,y.innerHTML=f.title,g.appendChild(y),e.appendChild(g)}),e.style.display="block"}).catch(d=>console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u0438\u0441\u043A\u0435:",d))})}),document.addEventListener("click",function(s){n.forEach(o=>{let e=o.querySelector(".search-results");e&&!o.contains(s.target)&&!e.contains(s.target)&&(e.style.display="none")})})});function G(){let n=0,s=0;document.querySelectorAll(".quantity-input").forEach(e=>{let p=e.parentElement.parentElement.previousElementSibling.querySelector(".price").textContent,d=e.parentElement.nextElementSibling.querySelector(".price"),f=parseInt(p,10),g=Number(e.value),y=g*f;d.textContent=y,s+=g,n+=y}),document.querySelector("[name=promo]").dispatchEvent(new Event("keyup")),document.querySelector("[name=true_price]").value=n,document.querySelector("[name=amount]").value=n??0,document.querySelector(".t_price").textContent=n??0;let o=re(s,["\u0431\u0438\u043B\u0435\u0442","\u0431\u0438\u043B\u0435\u0442\u0430","\u0431\u0438\u043B\u0435\u0442\u043E\u0432"]);document.querySelector(".tickets").textContent=s+" "+o,$()}function re(n,s){return s[n%100>4&&n%100<20?2:[2,0,1,1,1,2][n%10<5?Math.abs(n)%10:5]]}function $(){let n=document.querySelector('[name="20percent"]:checked');if(n&&n.value==="on"){let o=parseFloat(document.querySelector(".t_price").textContent)*.3;document.querySelector(".total-sale_price_count").textContent=Math.round(o),document.querySelector(".total-sale_price").classList.remove("hidden")}else document.querySelector(".total-sale_price").classList.add("hidden")}function K(){let n=document.querySelector("#order_form-page");document.querySelectorAll(".error_form_mes").forEach(E=>E.remove());let s=n.querySelector("[name=phone]").value.trim(),o=n.querySelector("[name=name]").value.trim(),e=n.querySelector("[name=mail]").value.trim(),p=0,d=0,f=/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/,g=/^[\w-\.]+@[\w-]+\.[a-z]{2,4}$/i,y=f.test(s),A=g.test(e),I=document.querySelector(".tours-content__form-title + .text-red");if(I&&I.remove(),document.querySelectorAll(".quantity-input").forEach(E=>{p+=parseInt(E.value)||0}),p===0){let E=document.createElement("div");E.className="text-red",E.textContent="\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043A\u043E\u043B-\u0432\u043E \u0431\u0438\u043B\u0435\u0442\u043E\u0432",document.querySelector(".tours-content__form-title").after(E),d=1}else document.querySelectorAll(".error_form_mes_time.ch_count").forEach(E=>E.remove());if(o)document.querySelector(".fio_field").classList.remove("alert");else{let E=document.createElement("div");E.className="error_form_mes error_form_mes_time fio",E.textContent="\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u043F\u043E\u043B\u0435",document.querySelector(".fio_field").classList.add("alert"),d=1}return s&&y?document.querySelector(".phones_field").classList.remove("alert"):(document.querySelector(".phones_field").classList.add("alert"),d=1),e&&A?document.querySelector(".email_field").classList.remove("alert"):(document.querySelector(".email_field").classList.add("alert"),d=1),d}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",n=>{if(n.target.closest(".increase-btn")){let s=n.target.closest("label");if(s){let o=s.querySelector(".quantity-input");if(o){let e=parseInt(o.value,10);e+=1,o.value=e}}G()}if(n.target.matches('[name="20percent"]')&&$(),n.target.closest(".decrease-btn")){let s=n.target.closest("label");if(s){let o=s.querySelector(".quantity-input");if(o){let e=parseInt(o.value,10);e>0&&(e-=1,o.value=e)}}G()}if(n.target.id==="submit_buy"){if(K())return;let s=document.getElementById("order_form-page"),o=new FormData(s),e=n.target,p=e.querySelector(".btn-text"),d=e.querySelector(".loader");console.log(e),e.disabled=!0,p.classList.add("hidden"),d.classList.remove("hidden"),fetch("/wp-content/themes/tw/theme/handler/buy_form.php",{method:"POST",headers:{},body:o}).then(f=>f.ok?f.json():f.json().then(g=>{throw new Error(g.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(f=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",f);let g=document.querySelector("#order_form-page");g.action=f.pay_url,g.submit()}).catch(f=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",f),alert(f.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{e.disabled=!1,p.classList.remove("hidden"),d.classList.add("hidden")})}if(n.target.id==="submit_request"){if(K())return;let s=n.target,o=s.querySelector(".btn-text"),e=s.querySelector(".loader");s.disabled=!0,o.classList.add("hidden"),e.classList.remove("hidden");let p=document.getElementById("order_form-page"),d=new FormData(p);fetch("/wp-content/themes/tw/theme/handler/order_form.php",{method:"POST",headers:{},body:d}).then(f=>f.ok?f.json():f.json().then(g=>{throw new Error(g.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(f=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",f),setTimeout(()=>{let g=document.querySelector('.popup[data-popup="popup-success-order"]');g&&g.classList.remove("hidden"),document.getElementById("order_form-page").reset(),s.disabled=!1,o.classList.remove("hidden"),e.classList.add("hidden")},10)}).catch(f=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",f),alert(f.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{s.disabled=!1,o.classList.remove("hidden"),e.classList.add("hidden")})}})});document.addEventListener("DOMContentLoaded",()=>{let n=document.querySelector("[name=promo]"),s=document.querySelector(".promo-loader"),o=document.getElementById("promo_ok"),e;n.addEventListener("keyup",()=>{n.value?(s.classList.add("active"),clearTimeout(e),e=setTimeout(()=>p(n.value),2e3),o.style.display="none"):s.classList.remove("active")}),n.addEventListener("keydown",()=>{clearTimeout(e)}),n.addEventListener("change",()=>{n.value||(s.classList.remove("active"),o.style.display="none")});async function p(d){let f=new FormData(document.getElementById("order_form-page"));f.append("promo",d);try{let y=await(await fetch("/wp-content/themes/tw/theme/handler/validate_promo.php",{method:"POST",body:f})).json();if(s.classList.remove("active"),y.ok){let A=parseInt(y.minus);document.getElementById("discount").dataset.fulldiscount=A;let I=document.querySelector("[name=amount]"),E=parseInt(I.value)-A;I.value=E,document.querySelector(".t_price").textContent=E,o.textContent=`\u041F\u0440\u043E\u043C\u043E\u043A\u043E\u0434 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u0435\u043D, \u0441\u043A\u0438\u0434\u043A\u0430 ${A} \u0440\u0443\u0431\u043B\u0435\u0439.`,o.style.color="green",o.style.display="block",n.readOnly=!0,$()}else o.textContent=y.msg||"\u041F\u0440\u043E\u043C\u043E\u043A\u043E\u0434 \u043D\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u0435\u043D.",o.style.color="red",o.style.display="block"}catch(g){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u0437\u0430\u043F\u0440\u043E\u0441\u0430!!:",g)}}});document.addEventListener("DOMContentLoaded",function(){let n=document.getElementById("cookie-banner"),s=document.getElementById("accept-cookies"),o=!1;n&&s&&(localStorage.getItem("cookiesAccepted")||n.classList.remove("hidden"),document.addEventListener("mousedown",function(e){o=e.isTrusted}),s.addEventListener("click",function(e){localStorage.setItem("cookiesAccepted","true"),n.classList.add("hidden"),e.stopPropagation()}),document.addEventListener("click",function(e){o&&!n.contains(e.target)&&(localStorage.setItem("cookiesAccepted","true"),n.classList.add("hidden"),e.stopPropagation()),o=!1}))});})();
