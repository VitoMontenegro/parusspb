(()=>{document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("input, textarea").forEach(e=>{e.addEventListener("focus",function(){this.dataset.placeholder=this.placeholder,this.placeholder=""}),e.addEventListener("blur",function(){this.placeholder=this.dataset.placeholder||""})});let l=document.getElementById("sidebar-menu"),d=window.scrollY;l&&window.addEventListener("scroll",()=>{window.scrollY>d?(l.classList.remove("lg:top-[40px]"),l.classList.add("lg:top-[-400px]")):(l.classList.remove("lg:top-[-400px]"),l.classList.add("lg:top-[40px]")),d=window.scrollY});let a=document.getElementById("menu-toggle"),t=document.getElementById("mobile-menu");a&&t&&(a.addEventListener("click",e=>{e.stopPropagation(),a.classList.contains("is-active")?(t.classList.remove("-translate-x-[1700px]"),t.classList.add("translate-x-0"),document.body.style.overflow="hidden"):(t.classList.remove("translate-x-0"),t.classList.add("-translate-x-[1700px]"),document.body.style.overflow=""),a.classList.toggle("is-active")}),document.addEventListener("click",e=>{!t.contains(e.target)&&!a.contains(e.target)&&(t.classList.remove("translate-x-0"),t.classList.add("-translate-x-[1700px]"),a.classList.add("is-active"),document.body.style.overflow="")}));let m=document.querySelectorAll(".sidebar-toggle"),h=document.getElementById("sidebar-menu");m.length&&h&&m.forEach(e=>{e.addEventListener("click",n=>{n.stopPropagation(),e.classList.contains("is-active")?(h.classList.remove("-translate-x-[1700px]"),h.classList.add("translate-x-0")):(h.classList.remove("translate-x-0"),h.classList.add("-translate-x-[1700px]")),e.classList.toggle("is-active")}),document.querySelectorAll(".close-filter-btn").forEach(n=>{n.addEventListener("click",()=>{e.classList.toggle("is-active"),h.classList.remove("translate-x-0"),h.classList.add("-translate-x-[1700px]")})}),document.addEventListener("click",n=>{!h.contains(n.target)&&!e.contains(n.target)&&(h.classList.remove("translate-x-0"),h.classList.add("-translate-x-[1700px]"),e.classList.add("is-active"))})});let L=new Swiper(".swiper_rev",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".rev-button-next",prevEl:".rev-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});L.on("init",()=>{document.querySelector(".rev-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".rev-button-next").classList.remove("swiper-button-disabled")}),L.init();let S=new Swiper(".swiper_similar",{slidesPerView:1,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".similar-button-next",prevEl:".similar-button-prev"},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}});L.on("init",()=>{document.querySelector(".similar-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".similar-button-next").classList.remove("swiper-button-disabled")}),L.init();let y=new Swiper(".swiper_gids",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".gid-button-next",prevEl:".gid-button-prev"},breakpoints:{490:{slidesPerView:3.5,spaceBetween:32}}});y.on("init",()=>{document.querySelector(".gid-button-prev").classList.remove("swiper-button-disabled"),document.querySelector(".gid-button-next").classList.remove("swiper-button-disabled")}),y.init();let A=new Swiper(".swiper_custom",{slidesPerView:1.2,spaceBetween:20,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:32}}}),I=new Swiper(".swiper_four",{slidesPerView:1.2,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:24},1100:{slidesPerView:4,spaceBetween:24}}}),B=new Swiper(".swiper_five",{slidesPerView:1.2,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{490:{slidesPerView:3,spaceBetween:24},1100:{slidesPerView:5,spaceBetween:24}}});if(document.querySelectorAll(".swiper_tour").length){let e=new Swiper(".mySwiper2",{spaceBetween:8,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}});document.querySelectorAll(".fancy-video img").forEach(s=>{let c=s.getAttribute("src"),p=s.getAttribute("alt"),u=s.getAttribute("data-video-id"),r=s.getAttribute("data-video-type");if(!u)s.setAttribute("data-src",c),s.setAttribute("data-caption",p);else{let o="";r==="youtube"?o=`https://www.youtube.com/embed/${u}?autoplay=1`:r==="rutube"?o=`https://rutube.ru/play/embed/${u}?autoplay=1`:r==="dzen"&&(o=u),s.setAttribute("data-fancybox","gallery"),s.setAttribute("data-src",o),s.setAttribute("data-caption",p)}}),Fancybox.bind('[data-fancybox="gallery"]',{infinite:!0,groupAll:!0,caption:function(s,c,p){return p.alt}})}if(document.querySelectorAll(".swiper_block")){let e=new Swiper(".swiperBlock",{slidesPerView:2.2,spaceBetween:11,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},breakpoints:{490:{slidesPerView:2.2,spaceBetween:11},790:{slidesPerView:3,spaceBetween:24},1023:{slidesPerView:5,spaceBetween:24}}})}if(document.querySelectorAll(".swiper_small")){let e=new Swiper(".swiper_small",{slidesPerView:1.5,spaceBetween:24,centeredSlides:!1,loop:!0,navigation:{nextEl:".rev-button-next",prevEl:".rev-button-prev"},breakpoints:{490:{slidesPerView:4,spaceBetween:24}}})}let k=null,i=flatpickr("#calendar",{inline:!0,mode:"range",minDate:"today",dateFormat:"Y-m-d",locale:"ru",onChange:function(e,n){k={dates:e,range:n}}}),b=document.getElementById("okBtn"),V=document.getElementById("cancelBtn");b&&V&&(b.addEventListener("click",function(){k&&k.dates.length?(document.querySelector('input[name="dateForm"]').value=k.range,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0}))):alert("\u041F\u043E\u0436\u0430\u043B\u0443\u0439\u0441\u0442\u0430, \u0432\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0438\u0430\u043F\u0430\u0437\u043E\u043D \u0434\u0430\u0442!")}),V.addEventListener("click",function(){k=null,i.clear(),j(),$(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(e=>{let n=window.location.origin+window.location.pathname;e.href=n.toString()})}));function N(){document.querySelectorAll(".calendar-wrapper").forEach(e=>{let n=e.querySelector(".calendar"),s=e.getAttribute("data-dates"),c=s?JSON.parse(s):[],p=flatpickr(n,{inline:!0,minDate:"today",dateFormat:"Y-m-d",locale:"ru",defaultDate:c,disable:[function(u){let r=u.toISOString().split("T")[0];return!c.includes(r)&&u<new Date}],onReady:function(){n.querySelectorAll(".flatpickr-day").forEach(r=>{let o=r.getAttribute("aria-label");!c.includes(o)&&r.classList.contains("flatpickr-disabled")&&r.classList.remove("selected")})},onChange:function(){p.setDate(c,!1)}})})}if(N(),document.addEventListener("click",function(e){e.target.id==="cancelBtnFilter"&&(k=null,i.clear(),j(),$(),document.querySelector('input[name="dateForm"]').value=null,document.querySelector('input[name="dateForm"]').dispatchEvent(new Event("change",{bubbles:!0})),document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(s=>{let c=window.location.origin+window.location.pathname;s.href=c.toString()}))}),document.addEventListener("click",function(e){let n=document.querySelectorAll(".dropdown-button"),s=document.querySelectorAll(".dropdown-menu"),c=e.target.closest(".dropdown-button");if(c){let r=Array.from(n).indexOf(c),o=s[r];if(!o)return;let w=o.classList.contains("hidden");s.forEach((f,g)=>{g!==r&&(f.classList.add("hidden"),n[g].setAttribute("aria-expanded","false"))}),w?(o.classList.remove("hidden"),c.setAttribute("aria-expanded","true")):(o.classList.add("hidden"),c.setAttribute("aria-expanded","false"));return}let p=e.target.closest(".dropdown-menu .item");if(p){let r=p.closest(".dropdown-menu"),o=document.querySelector('.dropdown-button[aria-expanded="true"]');r&&o&&(r.classList.add("hidden"),o.setAttribute("aria-expanded","false"));return}let u=e.target.closest(".dropdown-menu .close-menu");if(u){let r=u.closest(".dropdown-menu"),o=document.querySelector('.dropdown-button[aria-expanded="true"]');r&&o&&(r.classList.add("hidden"),o.setAttribute("aria-expanded","false"));return}s.forEach((r,o)=>{!r.contains(e.target)&&!n[o].contains(e.target)&&(r.classList.add("hidden"),n[o].setAttribute("aria-expanded","false"))})}),document.getElementById("category_id")){let n=function(){let s=f=>Array.from(document.querySelectorAll(`#filter-form input[name="${f}"]:checked, #sort_form input[name="${f}"]:checked`)).map(g=>g.value),c=s("duration"),p=s("price"),u=-1,r=s("grade_sort"),o=document.querySelector('input[name="dateForm"]').value??null,w=new URLSearchParams({grade_sort:JSON.stringify(r),price:JSON.stringify(p),duration:JSON.stringify(c),dateForm:o,posts_per_page:u,category_id:e});document.querySelectorAll("#cat_sidebar .flex.items-center a").forEach(f=>{let g=new URL(f.href);o&&g.searchParams.set("dateForm",o),p&&g.searchParams.set("price",JSON.stringify(p)),c&&g.searchParams.set("duration",JSON.stringify(c)),f.href=g.toString()}),fetch("/wp-json/my_namespace/v1/filter-posts/?"+w.toString()).then(f=>{if(!f.ok)throw new Error("Failed to fetch the template.");return f.json()}).then(f=>{console.log(f.data),document.getElementById("tours").innerHTML=f.data.html,document.getElementById("card_link").scrollIntoView({block:"start",behavior:"smooth"}),N(),R();let g=document.querySelectorAll(".sidebar-toggle"),v=document.getElementById("sidebar-menu");g.length&&v&&(g.forEach(E=>{E.classList.toggle("is-active")}),v.classList.remove("translate-x-0"),v.classList.add("-translate-x-[1700px]"))}).catch(f=>console.error("Error loading posts:",f))};var ne=n;let e=document.getElementById("category_id").value;document.getElementById("filter-form").addEventListener("change",function(){n()}),document.getElementById("sort_form").addEventListener("change",function(){n()})}function j(){let e=document.getElementById("filter-form");Array.from(e.elements).forEach(n=>{switch(n.type){case"text":case"textarea":case"password":case"email":case"url":case"number":case"search":case"tel":case"hidden":n.value="";break;case"checkbox":case"radio":n.checked=!1;break;case"select-one":case"select-multiple":n.selectedIndex=-1;break;default:break}})}function $(){let e=window.location.origin+window.location.pathname;window.history.replaceState({},document.title,e)}let J=document.querySelector(".reviews_form");if(J){let n=function(o,w){Array.from(w.querySelectorAll(".data-item")).forEach(g=>{g.style.display="block"}),w.classList.remove("hidden")},s=function(o,w){let f=o.value.toLowerCase(),g=Array.from(w.querySelectorAll(".data-item"));if(f===""){w.classList.add("hidden");return}let v=!1;g.forEach(E=>{E.textContent.toLowerCase().includes(f)?(E.style.display="block",v=!0):E.style.display="none"}),v?w.classList.remove("hidden"):w.classList.add("hidden")},c=function(){document.querySelectorAll(".reviews_form placeholder ul").forEach(o=>{o.classList.add("hidden")})};var oe=n,se=s,re=c;let e=document.getElementById("inputField");document.querySelectorAll(".list-input input[name]").forEach(o=>{let w=o.nextElementSibling;w&&(o.addEventListener("focus",()=>{c(),n(o,w)}),o.addEventListener("input",()=>s(o,w)),o.addEventListener("blur",()=>{setTimeout(()=>w.classList.add("hidden"),200)}),w.querySelectorAll(".data-item").forEach(f=>{f.addEventListener("click",()=>{console.log("item>>",o.getAttribute("id")),o.value=f.textContent,o.getAttribute("id")==="inputField1"&&(document.querySelector('input[name="excurs"]').value=f.getAttribute("data-name")),o.value=f.textContent,w.classList.add("hidden")})}))}),document.addEventListener("mousedown",o=>{let w=o.target.tagName==="INPUT",f=o.target.classList.contains("data-item");!w&&!f&&c()});let p=document.getElementById("photo-input"),u=document.getElementById("preview-container"),r=[];p.addEventListener("change",o=>{Array.from(o.target.files||[]).forEach(f=>{if(!f.type.startsWith("image/"))return;let g=new FileReader;g.onload=v=>{let E=document.createElement("div");E.classList.add("preview");let H=document.createElement("img");H.src=v.target?.result;let T=document.createElement("button");T.innerText="\xD7",T.onclick=()=>{let W=r.indexOf(f);W>-1&&r.splice(W,1),u.removeChild(E)},E.appendChild(H),E.appendChild(T),u.appendChild(E)},g.readAsDataURL(f),r.push(f)}),p.value=""}),J.addEventListener("submit",function(o){o.preventDefault();let w=o.target,f=w.querySelector("[name=name]").value,g=new FormData(w);if(r.forEach((v,E)=>{g.append(`file[${E}]`,v)}),!f){document.querySelector(".name_field input").classList.add("alert"),window.scrollTo({top:document.querySelector(".reviews_form").offsetTop-50,behavior:"smooth"});return}fetch("/wp-json/custom/v1/reviews-form",{method:"POST",headers:{},body:g}).then(v=>v.ok?v.json():v.json().then(E=>{throw new Error(E.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(v=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",v);let E=document.querySelector('.popup[data-popup="popup-success-rev"]');E&&E.classList.remove("hidden")}).catch(v=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",v),alert(v.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})})}document.querySelectorAll(".send-letter").forEach(e=>{e.addEventListener("submit",function(n){n.preventDefault();let s=n.target,c=s.getAttribute("data-api"),p=new FormData(s),u=s.querySelector('input[name="tel"]');if(u){let r=p.get("tel");if(isValidPhone(r))isValidPhone(r)&&u.classList.remove("border","border-[#FF7A45]");else return u.classList.add("border","border-[#FF7A45]"),!1}c&&fetch(`/wp-json/custom/v1/${c}`,{method:"POST",headers:{},body:p}).then(r=>r.ok?r.json():r.json().then(o=>{throw new Error(o.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(r=>{if(!r.success)throw new Error(r.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B");return s.reset(),z(),document.querySelector(".popup[data-popup='popup-success']").classList.remove("hidden"),!0}).catch(r=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",r),alert(r.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})})}),document.querySelectorAll("[data-open]").forEach(e=>{e.addEventListener("click",function(){let n=e.getAttribute("data-open"),s=document.querySelector(`.popup[data-popup="${n}"]`);s&&s.classList.remove("hidden")})});function te(e){e.classList.remove("hidden")}function z(){document.querySelectorAll(".popup-close").forEach(e=>{let n=e.closest(".popup");n&&n.classList.add("hidden")})}document.querySelectorAll(".popup-close").forEach(e=>{e.addEventListener("click",function(){let n=e.closest(".popup");n&&n.classList.add("hidden")})}),document.querySelectorAll(".popup").forEach(e=>{e.addEventListener("click",function(n){if(n.target===e){e.classList.add("hidden");let s=e.querySelector(".popup-media-container");s&&(s.innerHTML="")}})}),document.querySelectorAll(".togler").forEach(e=>{e.textContent="\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432",e.addEventListener("click",()=>{e.textContent=e.textContent==="\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432"?"\u0421\u0432\u0435\u0440\u043D\u0443\u0442\u044C \u043E\u0442\u0437\u044B\u0432":"\u0427\u0438\u0442\u0430\u0442\u044C \u0432\u0435\u0441\u044C \u043E\u0442\u0437\u044B\u0432";let n=e.closest(".text_toggle").querySelector(".rev-text");n&&(n.classList.toggle("long-rev"),n.classList.toggle("short-rev"))})});function R(){let e=document.getElementById("response");if(!e)return;let n=e.querySelectorAll(".wish-btn");if(s(n),e.dataset.initialized)return;e.dataset.initialized=!0,e.addEventListener("click",p=>{let u=p.target.closest(".wish-btn");u&&c(u)});function s(p){let u=C("product");try{u=u?JSON.parse(u):[]}catch(r){console.error("Error parsing cookies:",r),u=[]}p.forEach(r=>{let o=r.getAttribute("data-wp-id");u.includes(o)&&r.classList.add("active")})}function c(p){let u=C("product");try{u=u?JSON.parse(u):[]}catch(o){console.error("Error parsing cookies:",o),u=[]}let r=p.getAttribute("data-wp-id");u.includes(r)?(u=u.filter(o=>o!==r),p.classList.remove("active")):(u.push(r),p.classList.add("active")),X("product",JSON.stringify(u),7),Y("product","#product-count span","#product-count div")}}R();function Y(e,n,s){let c=C(e);if(c)try{let p=JSON.parse(c);Array.isArray(p)&&(document.querySelector(n).textContent=p.length,p.length<1?document.querySelector(s).style.visibility="hidden":document.querySelector(s).style.visibility="visible")}catch(p){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u0430\u0440\u0441\u0438\u043D\u0433\u0435 \u043A\u0443\u043A\u0438 '"+e+"':",p)}else document.querySelector(n).textContent=0}Y("product","#product-count span","#product-count div");function C(e){let n=document.cookie.split(";");for(let s=0;s<n.length;s++){let c=n[s].trim();if(c.startsWith(e+"="))return c.substring(e.length+1)}return null}function X(e,n,s){let c=new Date;c.setTime(c.getTime()+s*24*60*60*1e3);let p="expires="+c.toUTCString();document.cookie=e+"="+n+";"+p+";path=/"}document.body.addEventListener("click",function(e){if(e.target.classList.contains("delete")){let n=Array.from(document.querySelectorAll(".delete")).indexOf(e.target);console.log("\u0423\u0434\u0430\u043B\u044F\u0435\u043C \u0444\u0430\u0439\u043B:",n),filestoupload.splice(n,1),e.target.parentElement.remove(),console.log("Files to upload:",filestoupload.length)}}),window.addEventListener("scroll",function(){if(window.innerWidth>=1024)return;let e=document.getElementById("card_link"),n=document.getElementById("sticky-element");if(!e||!n)return;let s=e.getBoundingClientRect();s.top<=0&&s.bottom>=1e3?(n.classList.add("fixed"),n.classList.remove("hidden")):(n.classList.remove("fixed"),n.classList.add("hidden"))});let D=document.querySelectorAll(".int_mesta .item"),q=document.querySelector(".show-more");D.length&&q&&(D.length>6&&q.classList.remove("hidden"),q.addEventListener("click",function(){D.forEach(e=>e.classList.remove("hidden")),q.classList.add("hidden")}));let _=document.querySelector(".g-scrolling-carousel .overflow-x-auto");if(_){let e=!1,n,s;_.addEventListener("wheel",function(c){c.preventDefault(),_.scrollLeft+=c.deltaY}),_.addEventListener("mousedown",function(c){e=!0,n=c.pageX-_.offsetLeft,s=_.scrollLeft}),_.addEventListener("mouseleave",function(){e=!1}),_.addEventListener("mouseup",function(){e=!1}),_.addEventListener("mousemove",function(c){if(!e)return;c.preventDefault();let u=(c.pageX-_.offsetLeft-n)*3;_.scrollLeft=s-u})}let P=document.getElementById("scrollToTop");window.addEventListener("scroll",function(){window.scrollY>=800?P.classList.remove("hidden","opacity-0"):P.classList.add("hidden","opacity-0")}),P.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})});document.addEventListener("DOMContentLoaded",()=>{async function l(){let d=document.getElementById("order_form-page");if(d&&d.dataset.crm){let a=d.dataset.crm;fetch("/wp-json/custom/v1/tour_tickets?id="+a,{method:"POST",headers:{"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw new Error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u043B\u0443\u0447\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445");return t.json()}).then(t=>{window.dates=t;let m=document.querySelector('#order_form-page [type="date"]');m&&(m.value=window.dates.min_date,m.setAttribute("value",window.dates.min_date),m.setAttribute("min",window.dates.min_date),m.setAttribute("max",window.dates.max_date),m.dispatchEvent(new Event("change"))),document.dispatchEvent(new Event("dates_loaded",{bubbles:!0}))}).catch(t=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",t)})}}l().then(()=>{document.querySelector('#order_form-page [type="date"]')?.addEventListener("change",function(){let d=this.value,a="",t=[],m=[],h=[];if(window.dates&&window.dates.dates){window.dates.dates.forEach(i=>{h.includes(i.date)||(h.push(i.date),m.push(i)),d===i.date&&(i.time===i.a1||!i.a1||i.a1==="undefined")&&(a+=`<button type="button" class="time_btn tickets_addr_item" data-id="${i.id}"  data-crm="${i.tour_id}" data-time="${i.time}" data-ticks="${i.tickets}" data-a="a1"> ${i.time} </button>`)});let L=new Date,S=new Date;S.setDate(L.getDate()+1);let y=new Date;y.setDate(L.getDate()+2);let A=x(L.toISOString().split("T")[0]),I=x(S.toISOString().split("T")[0]),B=x(y.toISOString().split("T")[0]),F=m.some(i=>x(i.date)===A),O=m.some(i=>x(i.date)===I),M=m.some(i=>x(i.date)===B);if(F){let i=m.find(b=>x(b.date)===A);t.push({label:"\u0421\u0435\u0433\u043E\u0434\u043D\u044F",date:x(i.date),dateItem:i.date})}if(O){let i=m.find(b=>x(b.date)===I);t.push({label:"\u0417\u0430\u0432\u0442\u0440\u0430",date:x(i.date),dateItem:i.date})}if(M){let i=m.find(b=>x(b.date)===B);t.push({label:"\u041F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430",date:x(i.date),dateItem:i.date})}m.slice(t.length,t.length+3).forEach(i=>{t.length<3&&t.push({label:K(i.date),date:x(i.date),dateItem:i.date})}),flatpickr("#calendarSelected",{inline:!0,minDate:"today",dateFormat:"Y-m-d",locale:"ru",enable:h,onChange:function(i,b){document.querySelector('#order_form-page [type="date"]').value=b,document.querySelector('#order_form-page [type="date"]').setAttribute("value",b),document.querySelector('#order_form-page [type="date"]').dispatchEvent(new Event("change"))}});let k=document.getElementById("dateButtonsContainer");k.innerHTML="",t.forEach(i=>{let b=document.createElement("button");b.type="button",b.setAttribute("data-value",i.dateItem),d===i.dateItem?b.className="date_btn active":b.className="date_btn",b.innerHTML=`
						<span class="self-stretch justify-center items-center inline-flex pointer-events-none">
							<span class="text-lg font-normal leading-normal">${i.label}</span>
						</span>
						<span class="self-stretch justify-center items-center inline-flex pointer-events-none">
							<span class="text-lg font-bold leading-normal">${i.date}</span>
						</span>
					`,b.addEventListener("click",()=>{this.value=i.dateItem,this.setAttribute("value",i.dateItem),this.dispatchEvent(new Event("change")),console.log("\u0412\u044B\u0431\u0440\u0430\u043D\u0430 \u0434\u0430\u0442\u0430:",i.date)}),k.appendChild(b)}),m.length>t.length?document.getElementById("show_calendar").classList.remove("hidden"):document.getElementById("show_calendar").classList.add("hidden")}document.querySelector(".tickets_addr_items").innerHTML=a,document.querySelector(".tickets_addr_items > *:first-child")?.click(),a||(document.querySelector(".tickets_addr_note").textContent="\u041D\u0435\u0442 \u0431\u0438\u043B\u0435\u0442\u043E\u0432")})})});document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",l=>{l.target.classList.contains("date_btn")&&document.querySelectorAll(".date_btn").forEach(a=>{console.log(a),document.querySelector('#order_form-page [type="date"]').value!==a.getAttribute("data-value")?a.classList.remove("active"):a.classList.add("active")})})});var G=l=>["\u044F\u043D\u0432\u0430\u0440\u044F","\u0444\u0435\u0432\u0440\u0430\u043B\u044F","\u043C\u0430\u0440\u0442\u0430","\u0430\u043F\u0440\u0435\u043B\u044F","\u043C\u0430\u044F","\u0438\u044E\u043D\u044F","\u0438\u044E\u043B\u044F","\u0430\u0432\u0433\u0443\u0441\u0442\u0430","\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F","\u043E\u043A\u0442\u044F\u0431\u0440\u044F","\u043D\u043E\u044F\u0431\u0440\u044F","\u0434\u0435\u043A\u0430\u0431\u0440\u044F"][l-1]||"",K=l=>{let d=["\u0412\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435","\u041F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A","\u0412\u0442\u043E\u0440\u043D\u0438\u043A","\u0421\u0440\u0435\u0434\u0430","\u0427\u0435\u0442\u0432\u0435\u0440\u0433","\u041F\u044F\u0442\u043D\u0438\u0446\u0430","\u0421\u0443\u0431\u0431\u043E\u0442\u0430"],a=new Date(l);return d[a.getDay()]},x=l=>{let[d,a,t]=l.split("-");return`${parseInt(t)} ${G(parseInt(a))}`};document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",l=>{let d=l.target;if(!d.classList.contains("tickets_addr_item"))return;document.querySelectorAll(".tickets_addr_item").forEach(y=>y.classList.remove("active")),d.classList.add("active");let a=d.dataset.ticks,t=d.dataset.a,m=d.dataset.crm,h=d.dataset.time,L=d.dataset.id;document.getElementById(t)?.click(),document.querySelector('[name="trip"]').value=L;let S=document.querySelector('[name="id_crm"]');S.value!==m&&(S.value=m,document.getElementById("order_form-page").dataset.crm=m,document.getElementById("all-prices").classList.add("loading"),fetch("/wp-json/custom/v1/get_current_prices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m})}).then(y=>y.json()).then(y=>{Q(y),console.log(y),document.getElementById("all-prices").classList.remove("loading")}).catch(y=>console.error("Error:",y))),document.querySelectorAll(".tickets_addr__note").forEach(y=>y.remove()),document.getElementById("date_and_time").value=document.querySelector("#order_form-page [type=date]").value+" "+h,document.querySelectorAll(".selected_info").forEach(function(y){y.innerHTML=x(document.querySelector("#order_form-page [type=date]").value)+", "+h})})});function Q(l){[{key:"adult",selector:".form__p_vzroslie",inputName:"price_adults"},{key:"adult_i",selector:".form__p_vzroslie_inostrancy",inputName:"price_adults_for"},{key:"kid",selector:".form__p_doshkolniki",inputName:"price_childs"},{key:"old",selector:".form__p_pensionery",inputName:"price_old"},{key:"school",selector:".form__p_shkolniki",inputName:"price_school"},{key:"student",selector:".form__p_studenty",inputName:"price_students"}].forEach(({key:a,selector:t,inputName:m})=>{let h=document.querySelector(t),L=document.querySelector(`[name="${m}"]`);l[a]&&(h.textContent=l[a][1]||l[a][0],h.parentElement.nextElementSibling.textContent=l[a][1]?`${l[a][0]} \u0440\u0443\u0431.`:"",L.value=l[a][1]||l[a][0])})}document.addEventListener("DOMContentLoaded",function(){let l=document.querySelectorAll(".search-form");l.forEach(d=>{let a=d.querySelector("input"),t=document.createElement("ul");t.className="search-results no-scrollbar",t.style.listStyle="none",t.style.padding="10px 15px",t.style.border="1px solid #ccc",t.style.maxWidth="100%",t.style.display="none",t.style.position="absolute",t.style.backgroundColor="white",t.style.zIndex="1000",t.style.top="35px",t.style.width="285px",t.style.left="0",t.style.minWidth="300px",t.style.maxHeight="400px",t.style.borderRadius="12px",t.style.overflowY="auto",d.appendChild(t),a.addEventListener("input",function(){let m=a.value.trim();if(m.length<2){t.style.display="none";return}fetch(`/wp-json/custom/v1/search-excursions?search=${encodeURIComponent(m)}`).then(h=>h.json()).then(h=>{if(t.innerHTML="",h.length===0){t.style.display="none";return}h.forEach(L=>{let S=document.createElement("li");S.style.padding="5px",S.style.cursor="pointer";let y=document.createElement("a");y.href=L.link,y.innerHTML=L.title,S.appendChild(y),t.appendChild(S)}),t.style.display="block"}).catch(h=>console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043F\u043E\u0438\u0441\u043A\u0435:",h))})}),document.addEventListener("click",function(d){l.forEach(a=>{let t=a.querySelector(".search-results");t&&!a.contains(d.target)&&!t.contains(d.target)&&(t.style.display="none")})})});function U(){let l=0,d=0;document.querySelectorAll(".quantity-input").forEach(t=>{let m=t.parentElement.parentElement.previousElementSibling.querySelector(".price").textContent,h=t.parentElement.nextElementSibling.querySelector(".price"),L=parseInt(m,10),S=Number(t.value),y=S*L;h.textContent=y,console.log(h,y),d+=S,l+=y}),document.querySelector("[name=promo]").dispatchEvent(new Event("keyup")),document.querySelector("[name=true_price]").value=l,document.querySelector(".t_price").textContent=l;let a=Z(d,["\u0431\u0438\u043B\u0435\u0442","\u0431\u0438\u043B\u0435\u0442\u0430","\u0431\u0438\u043B\u0435\u0442\u043E\u0432"]);document.querySelector(".tickets").textContent=d+" "+a}function Z(l,d){return d[l%100>4&&l%100<20?2:[2,0,1,1,1,2][l%10<5?Math.abs(l)%10:5]]}document.addEventListener("DOMContentLoaded",function(){document.addEventListener("click",l=>{if(l.target.closest(".increase-btn")){let d=l.target.closest("label");if(d){let a=d.querySelector(".quantity-input");if(a){let t=parseInt(a.value,10);t+=1,a.value=t}}U()}if(l.target.closest(".decrease-btn")){let d=l.target.closest("label");if(d){let a=d.querySelector(".quantity-input");if(a){let t=parseInt(a.value,10);t>0&&(t-=1,a.value=t)}}U()}if(l.target.id==="submit_buy"){let d=document.getElementById("order_form-page"),a=new FormData(d);fetch("/wp-json/custom/v1/add_ticket",{method:"POST",headers:{},body:a}).then(t=>t.ok?t.json():t.json().then(m=>{throw new Error(m.message||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435 \u0444\u043E\u0440\u043C\u044B")})).then(t=>{console.log("\u041E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430:",t)}).catch(t=>{console.error("\u041E\u0448\u0438\u0431\u043A\u0430:",t),alert(t.message||"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A")}).finally(()=>{})}})});})();
